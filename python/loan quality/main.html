<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Predicting Loan Repayment</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="main_files/libs/clipboard/clipboard.min.js"></script>
<script src="main_files/libs/quarto-html/quarto.js"></script>
<script src="main_files/libs/quarto-html/popper.min.js"></script>
<script src="main_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="main_files/libs/quarto-html/anchor.min.js"></script>
<link href="main_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="main_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="main_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="main_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="main_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><strong>Predicting Loan Repayment</strong></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="author-karim-abdul-aziz-chatab" class="level2">
<h2 class="anchored" data-anchor-id="author-karim-abdul-aziz-chatab"><strong>Author: Karim Abdul Aziz Chatab</strong></h2>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">1. Introduction</h2>
<section id="business-context" class="level3">
<h3 class="anchored" data-anchor-id="business-context">1.1 Business Context</h3>
<p>This project was given 3 dataset from data.zip file where I, as the (potential) data scientist at MoneyLion plans to assess the loan repayment quality of the given customer in the dataset.</p>
</section>
<section id="required-libraries" class="level3">
<h3 class="anchored" data-anchor-id="required-libraries">1.2 Required Libraries</h3>
<div id="cell-2" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> missingno <span class="im">import</span> matrix</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> missingno</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly.subplots <span class="im">import</span> make_subplots</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, classification_report</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dataset-overview" class="level3">
<h3 class="anchored" data-anchor-id="dataset-overview">1.3 Dataset Overview</h3>
<p>Full information of the dataset is referred from the dictionary. But in short,</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
loan.csv
</div>
</div>
<div class="callout-body-container callout-body">
<p>This file returns 19 columns consist of the customer’s loan information along with their ssn and id. Every row represents and accepted loan application.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
payment.csv
</div>
</div>
<div class="callout-body-container callout-body">
<p>This file returns 9 columns consist of the customer’s payment information along with their ACH error codes and loan id.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
clarity_underwriting_variables.csv
</div>
</div>
<div class="callout-body-container callout-body">
<p>This file returns 54 rows and 10 columns where each row variable determine the underwriting report.</p>
</div>
</div>
<section id="importing-the-dataset" class="level4">
<h4 class="anchored" data-anchor-id="importing-the-dataset"><em>Importing the dataset:</em></h4>
<div id="cell-4" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>loan <span class="op">=</span> pd.read_csv(<span class="st">'data/loan.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>payment <span class="op">=</span> pd.read_csv(<span class="st">'data/payment.csv'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>clarity <span class="op">=</span> pd.read_csv(<span class="st">'data/clarity_underwriting_variables.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/bh/6mxzj6690ysbjw299n5mgbch0000gn/T/ipykernel_4299/1122626616.py:3: DtypeWarning: Columns (9,11,12,13,14,15,16,17,18,19,20,21,22,23,25,26,27,28,29,31,32,33,36,37) have mixed types. Specify dtype option on import or set low_memory=False.
  clarity = pd.read_csv('data/clarity_underwriting_variables.csv')</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="data-preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="data-preprocessing">2. Data Preprocessing</h2>
<section id="exploratory-data-analysis" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-data-analysis">2.1 Exploratory Data Analysis</h3>
<div id="cell-6" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#display loan</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(loan.head().to_string()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          loanId                          anon_ssn payFrequency    apr             applicationDate  originated              originatedDate  nPaidOff  approved  isFunded             loanStatus  loanAmount  originallyScheduledPaymentAmount state     leadType  leadCost fpStatus            clarityFraudId  hasCF
0  LL-I-07399092  beff4989be82aab4a5b47679216942fd            B  360.0  2016-02-23T17:29:01.940000       False                         NaN       0.0     False         0  Withdrawn Application       500.0                            978.27    IL  bvMandatory         6      NaN  5669ef78e4b0c9d3936440e6      1
1  LL-I-06644937  464f5d9ae4fa09ece4048d949191865c            B  199.0  2016-01-19T22:07:36.778000        True  2016-01-20T15:49:18.846000       0.0      True         1          Paid Off Loan      3000.0                           6395.19    CA    prescreen         0  Checked  569eb3a3e4b096699f685d64      1
2  LL-I-10707532  3c174ae9e2505a5f9ddbff9843281845            B  590.0  2016-08-01T13:51:14.709000       False                         NaN       0.0     False         0  Withdrawn Application       400.0                           1199.45    MO  bvMandatory         3      NaN  579eab11e4b0d0502870ef2f      1
3  LL-I-02272596  9be6f443bb97db7e95fa0c281d34da91            B  360.0  2015-08-06T23:58:08.880000       False                         NaN       0.0     False         0  Withdrawn Application       500.0                           1074.05    IL  bvMandatory         3      NaN  555b1e95e4b0f6f11b267c18      1
4  LL-I-09542882  63b5494f60b5c19c827c7b068443752c            B  590.0  2016-06-05T22:31:34.304000       False                         NaN       0.0     False         0               Rejected       350.0                            814.37    NV  bvMandatory         3      NaN  5754a91be4b0c6a2bf424772      1</code></pre>
</div>
</div>
<div id="cell-7" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#display payment</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(payment.head().to_string()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          loanId  installmentIndex  isCollection          paymentDate  principal    fees  paymentAmount paymentStatus paymentReturnCode
0  LL-I-00000021                 1         False  2014-12-19T05:00:00      22.33  147.28         169.61       Checked               NaN
1  LL-I-00000021                 2         False  2015-01-02T05:00:00      26.44  143.17         169.61       Checked               NaN
2  LL-I-00000021                 3         False  2015-01-16T05:00:00      31.30  138.31         169.61       Checked               NaN
3  LL-I-00000021                 4         False  2015-01-30T05:00:00      37.07  132.54         169.61       Checked               NaN
4  LL-I-00000021                 5         False  2015-02-13T05:00:00      43.89  125.72         169.61       Checked               NaN</code></pre>
</div>
</div>
<div id="cell-8" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#display clarity</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(clarity.head().to_string()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   .underwritingdataclarity.clearfraud.clearfraudinquiry.thirtydaysago  .underwritingdataclarity.clearfraud.clearfraudinquiry.twentyfourhoursago  .underwritingdataclarity.clearfraud.clearfraudinquiry.oneminuteago  .underwritingdataclarity.clearfraud.clearfraudinquiry.onehourago  .underwritingdataclarity.clearfraud.clearfraudinquiry.ninetydaysago  .underwritingdataclarity.clearfraud.clearfraudinquiry.sevendaysago  .underwritingdataclarity.clearfraud.clearfraudinquiry.tenminutesago  .underwritingdataclarity.clearfraud.clearfraudinquiry.fifteendaysago  .underwritingdataclarity.clearfraud.clearfraudinquiry.threesixtyfivedaysago .underwritingdataclarity.clearfraud.clearfraudindicator.inquiryonfilecurrentaddressconflict  .underwritingdataclarity.clearfraud.clearfraudindicator.totalnumberoffraudindicators .underwritingdataclarity.clearfraud.clearfraudindicator.telephonenumberinconsistentwithaddress .underwritingdataclarity.clearfraud.clearfraudindicator.inquiryageyoungerthanssnissuedate .underwritingdataclarity.clearfraud.clearfraudindicator.onfileaddresscautious .underwritingdataclarity.clearfraud.clearfraudindicator.inquiryaddressnonresidential .underwritingdataclarity.clearfraud.clearfraudindicator.onfileaddresshighrisk .underwritingdataclarity.clearfraud.clearfraudindicator.ssnreportedmorefrequentlyforanother .underwritingdataclarity.clearfraud.clearfraudindicator.currentaddressreportedbytradeopenlt90days .underwritingdataclarity.clearfraud.clearfraudindicator.inputssninvalid .underwritingdataclarity.clearfraud.clearfraudindicator.inputssnissuedatecannotbeverified .underwritingdataclarity.clearfraud.clearfraudindicator.inquiryaddresscautious .underwritingdataclarity.clearfraud.clearfraudindicator.morethan3inquiriesinthelast30days .underwritingdataclarity.clearfraud.clearfraudindicator.onfileaddressnonresidential .underwritingdataclarity.clearfraud.clearfraudindicator.creditestablishedpriortossnissuedate .underwritingdataclarity.clearfraud.clearfraudindicator.driverlicenseformatinvalid .underwritingdataclarity.clearfraud.clearfraudindicator.inputssnrecordedasdeceased .underwritingdataclarity.clearfraud.clearfraudindicator.inquiryaddresshighrisk .underwritingdataclarity.clearfraud.clearfraudindicator.inquirycurrentaddressnotonfile .underwritingdataclarity.clearfraud.clearfraudindicator.bestonfilessnissuedatecannotbeverified .underwritingdataclarity.clearfraud.clearfraudindicator.highprobabilityssnbelongstoanother  .underwritingdataclarity.clearfraud.clearfraudindicator.maxnumberofssnswithanybankaccount .underwritingdataclarity.clearfraud.clearfraudindicator.bestonfilessnrecordedasdeceased .underwritingdataclarity.clearfraud.clearfraudindicator.currentaddressreportedbynewtradeonly .underwritingdataclarity.clearfraud.clearfraudindicator.creditestablishedbeforeage18 .underwritingdataclarity.clearfraud.clearfraudindicator.telephonenumberinconsistentwithstate .underwritingdataclarity.clearfraud.clearfraudindicator.driverlicenseinconsistentwithonfile .underwritingdataclarity.clearfraud.clearfraudindicator.workphonepreviouslylistedascellphone .underwritingdataclarity.clearfraud.clearfraudindicator.workphonepreviouslylistedashomephone .underwritingdataclarity.clearfraud.clearfraudidentityverification.ssnnamematch .underwritingdataclarity.clearfraud.clearfraudidentityverification.nameaddressmatch .underwritingdataclarity.clearfraud.clearfraudidentityverification.phonematchtype .underwritingdataclarity.clearfraud.clearfraudidentityverification.ssnnamereasoncodedescription .underwritingdataclarity.clearfraud.clearfraudidentityverification.phonematchresult .underwritingdataclarity.clearfraud.clearfraudidentityverification.nameaddressreasoncodedescription .underwritingdataclarity.clearfraud.clearfraudidentityverification.phonematchtypedescription .underwritingdataclarity.clearfraud.clearfraudidentityverification.overallmatchresult .underwritingdataclarity.clearfraud.clearfraudidentityverification.phonetype .underwritingdataclarity.clearfraud.clearfraudidentityverification.ssndobreasoncode .underwritingdataclarity.clearfraud.clearfraudidentityverification.ssnnamereasoncode .underwritingdataclarity.clearfraud.clearfraudidentityverification.nameaddressreasoncode .underwritingdataclarity.clearfraud.clearfraudidentityverification.ssndobmatch  .underwritingdataclarity.clearfraud.clearfraudidentityverification.overallmatchreasoncode  clearfraudscore            underwritingid
0                                                                  8.0                                                                       2.0                                                                 2.0                                                               2.0                                                                  8.0                                                                 2.0                                                                  2.0                                                                   5.0                                                                         10.0                                                                                       False                                                                                   2.0                                                                                           True                                                                                     False                                                                         False                                                                                 True                                                                         False                                                                                       False                                                                                             False                                                                   False                                                                                     False                                                                          False                                                                                     False                                                                               False                                                                                        False                                                                                NaN                                                                              False                                                                          False                                                                                  False                                                                                          False                                                                                      False                                                                                        1.0                                                                                   False                                                                                        False                                                                                False                                                                                        False                                                                                         NaN                                                                                        False                                                                                        False                                                                           match                                                                             partial                                                                                 M                                                                                             NaN                                                                         unavailable                                                                        (A8) Match to Last Name only                                                                             (M) Mobile Phone                                                                               partial                                                                          NaN                                                                                 NaN                                                                                  NaN                                                                                       A8                                                                          match                                                                                        6.0            871.0  54cbffcee4b0ba763e43144d
1                                                                  5.0                                                                       2.0                                                                 2.0                                                               2.0                                                                 11.0                                                                 2.0                                                                  2.0                                                                   4.0                                                                         21.0                                                                                        True                                                                                   3.0                                                                                           True                                                                                     False                                                                         False                                                                                False                                                                         False                                                                                       False                                                                                             False                                                                   False                                                                                     False                                                                          False                                                                                     False                                                                               False                                                                                        False                                                                                NaN                                                                              False                                                                          False                                                                                   True                                                                                          False                                                                                      False                                                                                        1.0                                                                                   False                                                                                        False                                                                                False                                                                                        False                                                                                         NaN                                                                                        False                                                                                        False                                                                           match                                                                            mismatch                                                                                 M                                                                                             NaN                                                                         unavailable                                                                                                 NaN                                                                             (M) Mobile Phone                                                                               partial                                                                          NaN                                                                                 NaN                                                                                  NaN                                                                                      NaN                                                                          match                                                                                       11.0            397.0  54cc0408e4b0418d9a7f78af
2                                                                  9.0                                                                       4.0                                                                 2.0                                                               3.0                                                                 10.0                                                                 8.0                                                                  2.0                                                                   9.0                                                                         25.0                                                                                       False                                                                                   3.0                                                                                           True                                                                                     False                                                                         False                                                                                False                                                                         False                                                                                       False                                                                                             False                                                                   False                                                                                     False                                                                          False                                                                                     False                                                                               False                                                                                        False                                                                                NaN                                                                              False                                                                          False                                                                                  False                                                                                          False                                                                                      False                                                                                        2.0                                                                                   False                                                                                        False                                                                                False                                                                                        False                                                                                         NaN                                                                                         True                                                                                        False                                                                           match                                                                               match                                                                                 M                                                                                             NaN                                                                         unavailable                                                                                                 NaN                                                                             (M) Mobile Phone                                                                                 match                                                                          NaN                                                                                 NaN                                                                                  NaN                                                                                      NaN                                                                          match                                                                                        1.0            572.0  54cc0683e4b0418d9a80adb6
3                                                                  3.0                                                                       2.0                                                                 2.0                                                               2.0                                                                  9.0                                                                 2.0                                                                  2.0                                                                   2.0                                                                          9.0                                                                                       False                                                                                   1.0                                                                                           True                                                                                     False                                                                         False                                                                                False                                                                         False                                                                                       False                                                                                             False                                                                   False                                                                                     False                                                                          False                                                                                     False                                                                               False                                                                                        False                                                                                NaN                                                                              False                                                                          False                                                                                  False                                                                                          False                                                                                      False                                                                                        1.0                                                                                   False                                                                                        False                                                                                False                                                                                        False                                                                                         NaN                                                                                        False                                                                                        False                                                                           match                                                                            mismatch                                                                                 M                                                                                             NaN                                                                         unavailable                                                                                                 NaN                                                                             (M) Mobile Phone                                                                               partial                                                                          NaN                                                                                 NaN                                                                                  NaN                                                                                      NaN                                                                          match                                                                                       11.0            838.0  54cc0780e4b0ba763e43b74a
4                                                                  5.0                                                                       5.0                                                                 2.0                                                               2.0                                                                  6.0                                                                 5.0                                                                  2.0                                                                   5.0                                                                          6.0                                                                                       False                                                                                   1.0                                                                                           True                                                                                     False                                                                         False                                                                                False                                                                         False                                                                                       False                                                                                             False                                                                   False                                                                                     False                                                                          False                                                                                     False                                                                               False                                                                                        False                                                                                NaN                                                                              False                                                                          False                                                                                  False                                                                                          False                                                                                      False                                                                                        1.0                                                                                   False                                                                                        False                                                                                False                                                                                        False                                                                                         NaN                                                                                        False                                                                                        False                                                                           match                                                                               match                                                                                 M                                                                                             NaN                                                                         unavailable                                                                                                 NaN                                                                             (M) Mobile Phone                                                                                 match                                                                          NaN                                                                                 NaN                                                                                  NaN                                                                                      NaN                                                                          match                                                                                        1.0            768.0  54cc1d67e4b0ba763e445b45</code></pre>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="ss">f"Payment Rows: </span><span class="sc">{</span><span class="bu">len</span>(payment)<span class="sc">:,}</span><span class="ss">, Loan Rows: </span><span class="sc">{</span><span class="bu">len</span>(loan)<span class="sc">:,}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Payment Rows: 689,364, Loan Rows: 577,682</code></pre>
</div>
</div>
<section id="summary-statistic" class="level4">
<h4 class="anchored" data-anchor-id="summary-statistic">2.1.1 Summary Statistic</h4>
<section id="frequency-table-for-numerical-variable" class="level5">
<h5 class="anchored" data-anchor-id="frequency-table-for-numerical-variable">Frequency table for numerical variable</h5>
<div id="cell-11" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary table for payment.csv</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> describe_full(df):</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>   numeric_stats <span class="op">=</span> df.describe()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>   categorical_stats <span class="op">=</span> {col: df[col].value_counts() </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">for</span> col <span class="kw">in</span> df.select_dtypes(include<span class="op">=</span>[<span class="st">'object'</span>, <span class="st">'bool'</span>]).columns}</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>   <span class="bu">print</span>(<span class="st">"Numeric Statistics:"</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>   <span class="bu">print</span>(numeric_stats)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>   <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Categorical Counts:"</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> col, counts <span class="kw">in</span> categorical_stats.items():</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>       <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>       <span class="bu">print</span>(counts)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>describe_full(loan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Numeric Statistics:
                 apr       nPaidOff       isFunded     loanAmount  \
count  573760.000000  577658.000000  577682.000000  575432.000000   
mean      553.080972       0.037887       0.067480     514.245084   
std       110.046159       0.333366       0.250852     320.939929   
min         0.000000       0.000000       0.000000       0.000000   
25%       490.000000       0.000000       0.000000     350.000000   
50%       590.000000       0.000000       0.000000     500.000000   
75%       601.000000       0.000000       0.000000     500.000000   
max       705.590000      21.000000       1.000000    5000.000000   

       originallyScheduledPaymentAmount       leadCost          hasCF  
count                     577682.000000  577682.000000  577682.000000  
mean                        1428.897209       7.854389       0.619187  
std                          925.009141      12.853451       0.485587  
min                         -816.710000       0.000000       0.000000  
25%                         1023.640000       3.000000       0.000000  
50%                         1245.250000       3.000000       1.000000  
75%                         1615.660000       6.000000       1.000000  
max                        19963.630000     200.000000       1.000000  

Categorical Counts:

loanId:
loanId
LL-I-07399092    1
LL-I-09120818    1
LL-I-12495837    1
LL-I-09315207    1
LL-I-07105524    1
                ..
LL-I-18326270    1
LL-I-14232965    1
LL-I-06403601    1
LL-I-10713224    1
LL-I-04733921    1
Name: count, Length: 577426, dtype: int64

anon_ssn:
anon_ssn
c8bb49de1f8ff99d2ecddfb7037dc66e    35
0b87684b60c8b8f5d0bd40eb5811cd50    20
f971898a3c70e4c3c316cb4bc48b6e2e    18
6f0e71bc16f634fafcf5337cecdfb25e    16
64cd38e9cd1e06ed480b5e607494ce57    15
                                    ..
9e28174874e0ddfaab268a6fda20f419     1
ba2f64a44344fcf8b5f0c4076bb6777f     1
ebe6ec6901aa8f9f59520ac4e65e0142     1
d3c1943189c453ce5149dc5c7c921f06     1
d7e55e85266208ac4c353f42ebcde5ca     1
Name: count, Length: 459393, dtype: int64

payFrequency:
payFrequency
B    316654
W    137188
M     59092
I     33787
S     29688
Name: count, dtype: int64

applicationDate:
applicationDate
2017-01-03T18:05:40.811000    3
2016-08-19T14:07:17.373000    2
2016-08-11T03:12:23.616000    2
2016-09-12T16:56:05.319000    2
2016-11-29T23:27:55.525000    2
                             ..
2016-08-30T23:15:03.936000    1
2015-10-16T07:06:51.886000    1
2016-08-03T00:56:19.972000    1
2016-06-22T17:48:34.161000    1
2015-11-17T22:04:20.862000    1
Name: count, Length: 577624, dtype: int64

originated:
originated
False    531676
True      46006
Name: count, dtype: int64

originatedDate:
originatedDate
2017-03-06T22:29:45.066000    2
2015-02-20T19:40:33.329000    2
2016-01-20T15:49:18.846000    1
2015-12-13T18:52:44.655000    1
2017-03-18T19:15:07.210000    1
                             ..
2017-03-03T18:00:09.560000    1
2017-03-14T13:45:08.746000    1
2016-07-03T20:12:54.603000    1
2016-01-11T17:12:16.285000    1
2015-11-12T22:35:47.644000    1
Name: count, Length: 46042, dtype: int64

approved:
approved
False    537646
True      40036
Name: count, dtype: int64

loanStatus:
loanStatus
Withdrawn Application          450984
Rejected                        85070
Paid Off Loan                   11427
External Collection             11334
New Loan                         8112
Internal Collection              5567
Returned Item                    1182
CSR Voided New Loan              1026
Settlement Paid Off               708
Credit Return Void                704
Customer Voided New Loan          504
Settled Bankruptcy                326
Pending Paid Off                  169
Charged Off Paid Off              160
Pending Application Fee             5
Pending Rescind                     4
Pending Application                 4
Voided New Loan                     2
Charged Off                         1
Customver Voided New Loan           1
Settlement Pending Paid Off         1
Name: count, dtype: int64

state:
state
OH         90496
IL         66710
TX         49729
MO         49249
WI         40349
MI         34635
TN         32991
NC         26962
FL         25896
IN         25781
SC         23925
CA         22691
NV         11477
PA          9723
VA          9197
NJ          7641
UT          6742
AL          4327
MS          3786
CO          3615
LA          3431
AZ          3355
NM          3231
KY          2911
SD          2212
MN          2078
GA          1763
OK          1758
WY          1715
CT          1468
WA          1384
KS          1227
IA          1043
DE           880
ID           722
RI           689
NE           635
HI           621
AK           290
ND           207
NY             3
MD             3
OH-TEST        1
TX-TEST        1
Name: count, dtype: int64

leadType:
leadType
bvMandatory      475001
lead              72673
organic           22851
prescreen          4515
rc_returning       2069
california          479
lionpay              26
repeat               24
instant-offer        22
express              22
Name: count, dtype: int64

fpStatus:
fpStatus
Checked        32978
No Payments    11427
Rejected        5522
No Schedule     1323
Cancelled        249
Skipped          218
Pending            5
Returned           1
Name: count, dtype: int64

clarityFraudId:
clarityFraudId
561e95f7e4b0efa8a6cdc975    15
5675c05de4b08b757e32e3b4    14
583d9d11e4b0bb9d66559063    13
581101f3e4b04db4de10a616    12
5666318be4b0100e879ac2f0    10
                            ..
579a6118e4b0d050242220df     1
577e4a29e4b06e5979673c41     1
57dad980e4b01a79d8b38492     1
5748eaf5e4b061d2b9c3f275     1
564f801ae4b05a02bef951e8     1
Name: count, Length: 314915, dtype: int64</code></pre>
</div>
</div>
<div id="cell-12" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a frequency table function</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> freq(df, column):</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>   freq <span class="op">=</span> df[column].value_counts()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>   valid_perc <span class="op">=</span> df[column].value_counts(normalize<span class="op">=</span><span class="va">True</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>   total_perc <span class="op">=</span> df[column].value_counts(dropna<span class="op">=</span><span class="va">False</span>, normalize<span class="op">=</span><span class="va">True</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>   table <span class="op">=</span> pd.DataFrame({</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Freq'</span>: freq,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>       <span class="st">'% Valid'</span>: valid_perc,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>       <span class="st">'% Valid Cum.'</span>: valid_perc.cumsum(),</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>       <span class="st">'% Total'</span>: total_perc,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>       <span class="st">'% Total Cum.'</span>: total_perc.cumsum()</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>   }).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Add total row</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>   total_row <span class="op">=</span> pd.DataFrame({</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Freq'</span>: [<span class="bu">len</span>(df)],</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>       <span class="st">'% Valid'</span>: [<span class="dv">100</span>],</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>       <span class="st">'% Valid Cum.'</span>: [<span class="dv">100</span>],</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>       <span class="st">'% Total'</span>: [<span class="dv">100</span>],</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>       <span class="st">'% Total Cum.'</span>: [<span class="dv">100</span>]</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>   }, index<span class="op">=</span>[<span class="st">'Total'</span>])</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>   <span class="bu">print</span>(<span class="ss">f"--------------- `</span><span class="sc">{</span>column<span class="sc">}</span><span class="ss">` Frequency Table ---------------"</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> pd.concat([table, total_row])</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>freq(loan, <span class="st">'approved'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--------------- `approved` Frequency Table ---------------</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Freq</th>
<th data-quarto-table-cell-role="th">% Valid</th>
<th data-quarto-table-cell-role="th">% Valid Cum.</th>
<th data-quarto-table-cell-role="th">% Total</th>
<th data-quarto-table-cell-role="th">% Total Cum.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">False</td>
<td>537646</td>
<td>93.07</td>
<td>93.07</td>
<td>93.07</td>
<td>93.07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">True</td>
<td>40036</td>
<td>6.93</td>
<td>100.00</td>
<td>6.93</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>577682</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-13" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>freq(loan, <span class="st">'originated'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--------------- `originated` Frequency Table ---------------</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Freq</th>
<th data-quarto-table-cell-role="th">% Valid</th>
<th data-quarto-table-cell-role="th">% Valid Cum.</th>
<th data-quarto-table-cell-role="th">% Total</th>
<th data-quarto-table-cell-role="th">% Total Cum.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">False</td>
<td>531676</td>
<td>92.04</td>
<td>92.04</td>
<td>92.04</td>
<td>92.04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">True</td>
<td>46006</td>
<td>7.96</td>
<td>100.00</td>
<td>7.96</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>577682</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-14" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>freq(loan, <span class="st">'loanStatus'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--------------- `loanStatus` Frequency Table ---------------</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Freq</th>
<th data-quarto-table-cell-role="th">% Valid</th>
<th data-quarto-table-cell-role="th">% Valid Cum.</th>
<th data-quarto-table-cell-role="th">% Total</th>
<th data-quarto-table-cell-role="th">% Total Cum.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">CSR Voided New Loan</td>
<td>1026.0</td>
<td>0.18</td>
<td>99.55</td>
<td>0.18</td>
<td>99.48</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Charged Off</td>
<td>1.0</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Charged Off Paid Off</td>
<td>160.0</td>
<td>0.03</td>
<td>100.00</td>
<td>0.03</td>
<td>100.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Credit Return Void</td>
<td>704.0</td>
<td>0.12</td>
<td>99.80</td>
<td>0.12</td>
<td>99.73</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Customer Voided New Loan</td>
<td>504.0</td>
<td>0.09</td>
<td>99.88</td>
<td>0.09</td>
<td>99.82</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Customver Voided New Loan</td>
<td>1.0</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">External Collection</td>
<td>11334.0</td>
<td>1.96</td>
<td>96.80</td>
<td>1.96</td>
<td>96.73</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Internal Collection</td>
<td>5567.0</td>
<td>0.96</td>
<td>99.17</td>
<td>0.96</td>
<td>99.10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">New Loan</td>
<td>8112.0</td>
<td>1.41</td>
<td>98.20</td>
<td>1.40</td>
<td>98.14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Paid Off Loan</td>
<td>11427.0</td>
<td>1.98</td>
<td>94.84</td>
<td>1.98</td>
<td>94.77</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Pending Application</td>
<td>4.0</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Pending Application Fee</td>
<td>5.0</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Pending Paid Off</td>
<td>169.0</td>
<td>0.03</td>
<td>99.97</td>
<td>0.03</td>
<td>99.97</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Pending Rescind</td>
<td>4.0</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Rejected</td>
<td>85070.0</td>
<td>14.74</td>
<td>92.86</td>
<td>14.73</td>
<td>92.79</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Returned Item</td>
<td>1182.0</td>
<td>0.20</td>
<td>99.37</td>
<td>0.20</td>
<td>99.31</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Settled Bankruptcy</td>
<td>326.0</td>
<td>0.06</td>
<td>99.94</td>
<td>0.06</td>
<td>99.94</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Settlement Paid Off</td>
<td>708.0</td>
<td>0.12</td>
<td>99.67</td>
<td>0.12</td>
<td>99.61</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Settlement Pending Paid Off</td>
<td>1.0</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Voided New Loan</td>
<td>2.0</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Withdrawn Application</td>
<td>450984.0</td>
<td>78.12</td>
<td>78.12</td>
<td>78.07</td>
<td>78.07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.07</td>
<td>99.88</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>577682.0</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-15" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>freq(loan, <span class="st">'leadType'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--------------- `leadType` Frequency Table ---------------</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Freq</th>
<th data-quarto-table-cell-role="th">% Valid</th>
<th data-quarto-table-cell-role="th">% Valid Cum.</th>
<th data-quarto-table-cell-role="th">% Total</th>
<th data-quarto-table-cell-role="th">% Total Cum.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">bvMandatory</td>
<td>475001</td>
<td>82.23</td>
<td>82.23</td>
<td>82.23</td>
<td>82.23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lead</td>
<td>72673</td>
<td>12.58</td>
<td>94.81</td>
<td>12.58</td>
<td>94.81</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">organic</td>
<td>22851</td>
<td>3.96</td>
<td>98.76</td>
<td>3.96</td>
<td>98.76</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">prescreen</td>
<td>4515</td>
<td>0.78</td>
<td>99.54</td>
<td>0.78</td>
<td>99.54</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">rc_returning</td>
<td>2069</td>
<td>0.36</td>
<td>99.90</td>
<td>0.36</td>
<td>99.90</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">california</td>
<td>479</td>
<td>0.08</td>
<td>99.98</td>
<td>0.08</td>
<td>99.98</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lionpay</td>
<td>26</td>
<td>0.00</td>
<td>99.99</td>
<td>0.00</td>
<td>99.99</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">repeat</td>
<td>24</td>
<td>0.00</td>
<td>99.99</td>
<td>0.00</td>
<td>99.99</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">instant-offer</td>
<td>22</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">express</td>
<td>22</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>577682</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-16" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>freq(loan, <span class="st">'fpStatus'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--------------- `fpStatus` Frequency Table ---------------</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Freq</th>
<th data-quarto-table-cell-role="th">% Valid</th>
<th data-quarto-table-cell-role="th">% Valid Cum.</th>
<th data-quarto-table-cell-role="th">% Total</th>
<th data-quarto-table-cell-role="th">% Total Cum.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Cancelled</td>
<td>249.0</td>
<td>0.48</td>
<td>99.57</td>
<td>0.04</td>
<td>99.96</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Checked</td>
<td>32978.0</td>
<td>63.76</td>
<td>63.76</td>
<td>5.71</td>
<td>96.76</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">No Payments</td>
<td>11427.0</td>
<td>22.09</td>
<td>85.85</td>
<td>1.98</td>
<td>98.73</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">No Schedule</td>
<td>1323.0</td>
<td>2.56</td>
<td>99.09</td>
<td>0.23</td>
<td>99.92</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Pending</td>
<td>5.0</td>
<td>0.01</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Rejected</td>
<td>5522.0</td>
<td>10.68</td>
<td>96.53</td>
<td>0.96</td>
<td>99.69</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Returned</td>
<td>1.0</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Skipped</td>
<td>218.0</td>
<td>0.42</td>
<td>99.99</td>
<td>0.04</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>91.05</td>
<td>91.05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total</td>
<td>577682.0</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-17" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>nPaidOff_mean <span class="op">=</span> <span class="bu">round</span>(loan[<span class="st">'nPaidOff'</span>].dropna().mean() <span class="op">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average pay off rate: </span><span class="sc">{</span>nPaidOff_mean<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average pay off rate: 3.79</code></pre>
</div>
</div>
<p>loan.csv shows a high-risk lending operation due to very low approval where 40,036 loan was approved out of 577,682 it has 6.93% approval rate. Although relatively high APR (median of 590%), only 7.96% Originated from applications. High APRs, low approval rates, low originated rates, and low pay off rate suggesting this is a high-risk lending operation indicate majority are <strong>subprime borrower base with significant credit risk.</strong></p>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>loan_numeric <span class="op">=</span> loan[[<span class="st">'originallyScheduledPaymentAmount'</span>, <span class="st">'loanAmount'</span>, <span class="st">'apr'</span>]]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>paymentAmount_max <span class="op">=</span> loan_numeric[<span class="st">'originallyScheduledPaymentAmount'</span>].<span class="bu">max</span>()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>loanAmount_max <span class="op">=</span> loan_numeric[<span class="st">'loanAmount'</span>].dropna().<span class="bu">max</span>()</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure()</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col, color, name <span class="kw">in</span> [</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'loanAmount'</span>, <span class="st">'salmon'</span>, <span class="st">'Loan Amount'</span>),</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'originallyScheduledPaymentAmount'</span>, <span class="st">'turquoise'</span>, <span class="st">'Originally Scheduled Payment Amount'</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                        ]:</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        fig.add_trace(go.Histogram(</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>loan_numeric[col].dropna(),</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span>name,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>                opacity<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>                marker_color<span class="op">=</span>color,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>                nbinsx<span class="op">=</span><span class="dv">30</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val, color, name <span class="kw">in</span> [</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>        (loanAmount_max, <span class="st">'salmon'</span>, <span class="st">'Max Loan'</span>),</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>        (paymentAmount_max, <span class="st">'turquoise'</span>, <span class="st">'Max Payment'</span>)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>]:</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>        fig.add_vline(</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>val,</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>                line_dash<span class="op">=</span><span class="st">"dash"</span>,</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>                line_color<span class="op">=</span>color,</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>                annotation_text<span class="op">=</span><span class="ss">f"$</span><span class="sc">{</span>val<span class="sc">:,.2f}</span><span class="ss">"</span>,</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>                annotation_position<span class="op">=</span><span class="st">"top"</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>        )       </span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>        fig.update_layout(</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>        barmode<span class="op">=</span><span class="st">'overlay'</span>,</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>        xaxis_title<span class="op">=</span><span class="st">'Dollars (USD)'</span>,</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>        showlegend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>                yanchor<span class="op">=</span><span class="st">"top"</span>,</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span><span class="fl">0.99</span>,</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>                xanchor<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span><span class="fl">1.05</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>        margin<span class="op">=</span><span class="bu">dict</span>(r<span class="op">=</span><span class="dv">150</span>)      </span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>Assuming this is in USD (since all the states mentioned are from United States). With loan amounts generally being higher than scheduled payments. The dashed line indicate the maximum for loan amount and payment amount. Maximum loan is $5,000 while maximum original payment shows the 4x multiplier from interest and fees resulting in $19,963.63 payment amount.</p>
<div id="cell-21" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>freq(loan, <span class="st">'payFrequency'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--------------- `payFrequency` Frequency Table ---------------</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Freq</th>
<th data-quarto-table-cell-role="th">% Valid</th>
<th data-quarto-table-cell-role="th">% Valid Cum.</th>
<th data-quarto-table-cell-role="th">% Total</th>
<th data-quarto-table-cell-role="th">% Total Cum.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">B</td>
<td>316654.0</td>
<td>54.94</td>
<td>54.94</td>
<td>54.81</td>
<td>54.81</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">I</td>
<td>33787.0</td>
<td>5.86</td>
<td>94.85</td>
<td>5.85</td>
<td>94.64</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">M</td>
<td>59092.0</td>
<td>10.25</td>
<td>88.99</td>
<td>10.23</td>
<td>88.79</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">S</td>
<td>29688.0</td>
<td>5.15</td>
<td>100.00</td>
<td>5.14</td>
<td>99.78</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">W</td>
<td>137188.0</td>
<td>23.80</td>
<td>78.74</td>
<td>23.75</td>
<td>78.56</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.22</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>577682.0</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Majority of 54.94% or 316,654 loans were paid biweekly (B) where least common were paid semi-monthly (S). However, there are mising data in this variable. lets investigate!</p>
<div id="cell-23" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This might be used later, hence i create this function </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> view_missing_frequency(df, column):</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>   missing_freq <span class="op">=</span> df[df[column].isna()].head()</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>   <span class="bu">print</span>(missing_freq.to_string())</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>view_missing_frequency(loan, <span class="st">'payFrequency'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             loanId                          anon_ssn payFrequency    apr             applicationDate  originated originatedDate  nPaidOff  approved  isFunded             loanStatus  loanAmount  originallyScheduledPaymentAmount state leadType  leadCost     fpStatus            clarityFraudId  hasCF
214   LL-I-08119905  8d94d36f11e4b203189e1694b52b6f61          NaN  590.0  2016-03-25T17:32:23.432000       False            NaN       0.0     False         0  Withdrawn Application       300.0                               0.0    OH  organic         0  No Payments  56f57622e4b030e93c770970      1
821   LL-I-08854991  dd5291dc42c18b5d97b6747cf5102fd4          NaN  590.0  2016-04-19T23:20:40.375000       False            NaN       0.0     False         0  Withdrawn Application       300.0                               0.0    IN  organic         0  No Payments  5716bd44e4b0cd57626777c6      1
1461  LL-I-11401749  9d2851e8d30add57fb6cc6722e0f25d7          NaN  590.0  2016-08-24T00:46:42.965000       False            NaN       0.0     False         0               Rejected       300.0                               0.0    TN  organic         0  No Payments  57bcee6ee4b033e6e6541c1a      1
1961  LL-I-11826560  40a58015111e3d9599975322aff494c1          NaN  590.0  2016-09-07T11:49:25.009000       False            NaN       0.0     False         0               Rejected       300.0                               0.0    CA  organic         0  No Payments  57ce6808e4b092499fe7209e      1
2136  LL-I-16240119  fad43a089c335acb76aa6b9aaf111a0a          NaN  645.0  2017-01-25T22:59:58.767000       False            NaN       0.0     False         0  Withdrawn Application       500.0                               0.0    KY  organic         0  No Payments  58548f8ee4b08f245ec11450      1</code></pre>
</div>
</div>
<p>Apparently, the first 5 <code>approved</code> variable is false, lets call all the unique values in payfrequency.</p>
<div id="cell-25" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>unique_values <span class="op">=</span> loan[loan[<span class="st">'payFrequency'</span>].isna()][<span class="st">'approved'</span>].unique()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"All approved values after filtering pay frequency: </span><span class="sc">{</span>unique_values<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>All approved values after filtering pay frequency: [False]</code></pre>
</div>
</div>
<p>So it seems all NA from pay frequency is a result of unapproved loan.</p>
</section>
<section id="summary-statistic-of-payment.csv" class="level5">
<h5 class="anchored" data-anchor-id="summary-statistic-of-payment.csv">Summary Statistic of payment.csv</h5>
<div id="cell-27" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>describe_full(payment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Numeric Statistics:
       installmentIndex      principal           fees  paymentAmount
count     689364.000000  689364.000000  689364.000000  689364.000000
mean          10.553222      45.557543      67.003994     112.680232
std            8.049530      81.724683      59.789510     105.783710
min            1.000000    -303.370000     -42.560000    -337.700000
25%            5.000000      13.180000      28.820000      56.810000
50%            9.000000      27.610000      51.300000      86.340000
75%           14.000000      53.380000      86.440000     135.090000
max          105.000000    4000.000000    1257.710000    4063.600000

Categorical Counts:

loanId:
loanId
LL-I-12230332    105
LL-I-08320897    105
LL-I-17454600    105
LL-I-09757835    105
LL-I-12217217    104
                ... 
LL-I-01714117      6
LL-I-15577134      6
LL-I-16759210      6
LL-I-01726796      6
LL-I-01138268      3
Name: count, Length: 39952, dtype: int64

isCollection:
isCollection
False    675469
True      13895
Name: count, dtype: int64

paymentDate:
paymentDate
2017-03-31T04:00:00           10236
2017-04-28T04:00:00            9336
2017-04-14T04:00:00            9138
2017-03-24T04:00:00            8942
2017-04-07T04:00:00            8899
                              ...  
2017-03-09T13:13:48.688000        1
2016-04-05T16:57:07.031000        1
2016-03-04T19:08:06.944000        1
2016-03-10T20:01:30.769000        1
2019-03-13T04:00:00               1
Name: count, Length: 18436, dtype: int64

paymentStatus:
paymentStatus
Cancelled                  270334
Checked                    209621
Rejected                    32330
Pending                      9241
Skipped                      3761
Rejected Awaiting Retry        18
Returned                        1
Complete                        1
Name: count, dtype: int64

paymentReturnCode:
paymentReturnCode
R01       22866
R02        2761
R08        2259
R16        1085
R10         620
MISSED      537
R03         318
RXS         226
R09         176
R07         160
C05         106
C01          87
R20          83
R99          60
RAF          58
R04          39
C03          34
C02          10
RWC           7
LPP01         7
R06           6
RUP           6
RBW           5
R29           4
RFG           3
R15           3
R13           2
C07           2
RIR           1
R19           1
RXL           1
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="cell-28" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>freq(payment, <span class="st">'isCollection'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--------------- `isCollection` Frequency Table ---------------</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Freq</th>
<th data-quarto-table-cell-role="th">% Valid</th>
<th data-quarto-table-cell-role="th">% Valid Cum.</th>
<th data-quarto-table-cell-role="th">% Total</th>
<th data-quarto-table-cell-role="th">% Total Cum.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">False</td>
<td>675469</td>
<td>97.98</td>
<td>97.98</td>
<td>97.98</td>
<td>97.98</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">True</td>
<td>13895</td>
<td>2.02</td>
<td>100.00</td>
<td>2.02</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>689364</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-29" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>freq(payment,<span class="st">'paymentReturnCode'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--------------- `paymentReturnCode` Frequency Table ---------------</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Freq</th>
<th data-quarto-table-cell-role="th">% Valid</th>
<th data-quarto-table-cell-role="th">% Valid Cum.</th>
<th data-quarto-table-cell-role="th">% Total</th>
<th data-quarto-table-cell-role="th">% Total Cum.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">C01</td>
<td>87.0</td>
<td>0.28</td>
<td>98.95</td>
<td>0.01</td>
<td>99.95</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">C02</td>
<td>10.0</td>
<td>0.03</td>
<td>99.85</td>
<td>0.00</td>
<td>99.99</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">C03</td>
<td>34.0</td>
<td>0.11</td>
<td>99.82</td>
<td>0.00</td>
<td>99.99</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">C05</td>
<td>106.0</td>
<td>0.34</td>
<td>98.67</td>
<td>0.02</td>
<td>99.94</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">C07</td>
<td>2.0</td>
<td>0.01</td>
<td>99.99</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">LPP01</td>
<td>7.0</td>
<td>0.02</td>
<td>99.89</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">MISSED</td>
<td>537.0</td>
<td>1.70</td>
<td>95.54</td>
<td>0.08</td>
<td>99.80</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">R01</td>
<td>22866.0</td>
<td>72.51</td>
<td>72.51</td>
<td>3.32</td>
<td>98.74</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">R02</td>
<td>2761.0</td>
<td>8.76</td>
<td>81.27</td>
<td>0.40</td>
<td>99.14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">R03</td>
<td>318.0</td>
<td>1.01</td>
<td>96.55</td>
<td>0.05</td>
<td>99.84</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">R04</td>
<td>39.0</td>
<td>0.12</td>
<td>99.71</td>
<td>0.01</td>
<td>99.99</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">R06</td>
<td>6.0</td>
<td>0.02</td>
<td>99.91</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">R07</td>
<td>160.0</td>
<td>0.51</td>
<td>98.34</td>
<td>0.02</td>
<td>99.92</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">R08</td>
<td>2259.0</td>
<td>7.16</td>
<td>88.43</td>
<td>0.33</td>
<td>99.47</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">R09</td>
<td>176.0</td>
<td>0.56</td>
<td>97.83</td>
<td>0.03</td>
<td>99.90</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">R10</td>
<td>620.0</td>
<td>1.97</td>
<td>93.84</td>
<td>0.09</td>
<td>99.72</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">R13</td>
<td>2.0</td>
<td>0.01</td>
<td>99.98</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">R15</td>
<td>3.0</td>
<td>0.01</td>
<td>99.98</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">R16</td>
<td>1085.0</td>
<td>3.44</td>
<td>91.88</td>
<td>0.16</td>
<td>99.63</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">R19</td>
<td>1.0</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">R20</td>
<td>83.0</td>
<td>0.26</td>
<td>99.21</td>
<td>0.01</td>
<td>99.96</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">R29</td>
<td>4.0</td>
<td>0.01</td>
<td>99.96</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">R99</td>
<td>60.0</td>
<td>0.19</td>
<td>99.40</td>
<td>0.01</td>
<td>99.97</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RAF</td>
<td>58.0</td>
<td>0.18</td>
<td>99.58</td>
<td>0.01</td>
<td>99.98</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">RBW</td>
<td>5.0</td>
<td>0.02</td>
<td>99.95</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RFG</td>
<td>3.0</td>
<td>0.01</td>
<td>99.97</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">RIR</td>
<td>1.0</td>
<td>0.00</td>
<td>99.99</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RUP</td>
<td>6.0</td>
<td>0.02</td>
<td>99.93</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">RWC</td>
<td>7.0</td>
<td>0.02</td>
<td>99.87</td>
<td>0.00</td>
<td>99.99</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RXL</td>
<td>1.0</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">RXS</td>
<td>226.0</td>
<td>0.72</td>
<td>97.27</td>
<td>0.03</td>
<td>99.88</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>95.43</td>
<td>95.43</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>689364.0</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-30" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>freq(payment,<span class="st">'paymentStatus'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--------------- `paymentStatus` Frequency Table ---------------</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Freq</th>
<th data-quarto-table-cell-role="th">% Valid</th>
<th data-quarto-table-cell-role="th">% Valid Cum.</th>
<th data-quarto-table-cell-role="th">% Total</th>
<th data-quarto-table-cell-role="th">% Total Cum.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Cancelled</td>
<td>270334.0</td>
<td>51.46</td>
<td>51.46</td>
<td>39.21</td>
<td>39.21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Checked</td>
<td>209621.0</td>
<td>39.90</td>
<td>91.37</td>
<td>30.41</td>
<td>69.62</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Complete</td>
<td>1.0</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Pending</td>
<td>9241.0</td>
<td>1.76</td>
<td>99.28</td>
<td>1.34</td>
<td>99.45</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Rejected</td>
<td>32330.0</td>
<td>6.15</td>
<td>97.52</td>
<td>4.69</td>
<td>98.11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Rejected Awaiting Retry</td>
<td>18.0</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Returned</td>
<td>1.0</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>100.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Skipped</td>
<td>3761.0</td>
<td>0.72</td>
<td>100.00</td>
<td>0.55</td>
<td>100.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>23.80</td>
<td>93.42</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total</td>
<td>689364.0</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
<td>100.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>It seems unusual how, principal, fees and payment amount has a negative value. Although, this could be because of data entry errors, refunds or reversals and system errors in calculation.</p>
<div id="cell-32" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>fees_max <span class="op">=</span> payment[<span class="st">'fees'</span>].<span class="bu">max</span>()</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>payamount_max <span class="op">=</span> payment[<span class="st">'paymentAmount'</span>].<span class="bu">max</span>()</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>principal_max <span class="op">=</span> payment[<span class="st">'principal'</span>].<span class="bu">max</span>()</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure()</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col, color <span class="kw">in</span> [(<span class="st">'principal'</span>, <span class="st">'lightblue'</span>), </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>                    (<span class="st">'paymentAmount'</span>, <span class="st">'turquoise'</span>),</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>                    (<span class="st">'fees'</span>, <span class="st">'salmon'</span>)]:</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Histogram(</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>payment[col],</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span>col,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>        opacity<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>        marker_color<span class="op">=</span>color,</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>        nbinsx<span class="op">=</span><span class="dv">30</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Add vertical lines</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val, color, name <span class="kw">in</span> [(fees_max, <span class="st">'salmon'</span>, <span class="st">'Max Fees'</span>), </span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>                        (payamount_max, <span class="st">'turquoise'</span>, <span class="st">'Max Payment'</span>),</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>                        (principal_max, <span class="st">'lightblue'</span>, <span class="st">'Max Principal'</span>)]:</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    fig.add_vline(x<span class="op">=</span>val, </span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>                line_dash<span class="op">=</span><span class="st">"dash"</span>,</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>                line_color<span class="op">=</span>color,</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>                annotation_text<span class="op">=</span><span class="ss">f"$</span><span class="sc">{</span>val<span class="sc">:,.2f}</span><span class="ss">"</span>,</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>                annotation_position<span class="op">=</span><span class="st">"top"</span>)</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>    barmode<span class="op">=</span><span class="st">'overlay'</span>,</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Payment Distributions'</span>,</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>    xaxis_title<span class="op">=</span><span class="st">'Amount'</span>,</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>    showlegend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>        yanchor<span class="op">=</span><span class="st">"top"</span>,</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="fl">0.99</span>,</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>        xanchor<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="fl">1.05</span></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>    margin<span class="op">=</span><span class="bu">dict</span>(r<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div id="cell-33" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_installments(df):</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>   installments <span class="op">=</span> df.groupby(<span class="st">'loanId'</span>).size().reset_index(name<span class="op">=</span><span class="st">'count'</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>   fig <span class="op">=</span> go.Figure()</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Add histogram</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>   fig.add_trace(go.Histogram(</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>       x<span class="op">=</span>installments[<span class="st">'count'</span>],</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>       nbinsx<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>       marker_color<span class="op">=</span><span class="st">'lightblue'</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>   ))</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>   max_val <span class="op">=</span> df[<span class="st">'installmentIndex'</span>].<span class="bu">max</span>()</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>   median_val <span class="op">=</span> df[<span class="st">'installmentIndex'</span>].median()</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> val, text <span class="kw">in</span> [(max_val, <span class="st">'Maximum'</span>), (median_val, <span class="st">'Median'</span>)]:</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>       fig.add_vline(</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>           x<span class="op">=</span>val,</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>           line_dash<span class="op">=</span><span class="st">"dash"</span>,</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>           annotation_text<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>val<span class="sc">:.0f}</span><span class="ss">"</span>,</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>           annotation_position<span class="op">=</span><span class="st">"top"</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>   fig.update_layout(</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>       title<span class="op">=</span><span class="st">'Distribution of Total Installments per Loan'</span>,</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>       xaxis_title<span class="op">=</span><span class="st">'Number of Installments'</span>,</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>       showlegend<span class="op">=</span><span class="va">False</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Print summary statistics</span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>   summary <span class="op">=</span> df[<span class="st">'installmentIndex'</span>].describe()</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>   <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Installment Index Summary:"</span>)</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>   <span class="bu">print</span>(summary)</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> fig</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>plot_installments(payment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Installment Index Summary:
count    689364.000000
mean         10.553222
std           8.049530
min           1.000000
25%           5.000000
50%           9.000000
75%          14.000000
max         105.000000
Name: installmentIndex, dtype: float64</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>The maximum installment is 105 installments, but it’s rare - the distribution is heavily right-skewed, suggesting most borrowers have shorter-term repayment schedules where most loans have less than 25 installments payments. The average installments per loan is repaid per 10 installment while the median is 9.</p>
<div id="cell-35" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_trends(df, min_installments<span class="op">=</span><span class="dv">60</span>):</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Get loans with installments above threshold</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>   top_loans <span class="op">=</span> (df.groupby(<span class="st">'loanId'</span>)[<span class="st">'installmentIndex'</span>]</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>               .<span class="bu">max</span>()</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>               .reset_index()</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>               .query(<span class="ss">f'installmentIndex &gt; </span><span class="sc">{</span>min_installments<span class="sc">}</span><span class="ss">'</span>))</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Filter payments for those loans</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>   filtered_payments <span class="op">=</span> df[df[<span class="st">'loanId'</span>].isin(top_loans[<span class="st">'loanId'</span>])]</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>   fig <span class="op">=</span> px.line(filtered_payments, </span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>                 x<span class="op">=</span><span class="st">'paymentDate'</span>, </span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>                 y<span class="op">=</span><span class="st">'fees'</span>,</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">'loanId'</span>,</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>                 title<span class="op">=</span><span class="ss">f'Installments &gt;= </span><span class="sc">{</span>min_installments<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>   fig.update_layout(showlegend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> fig</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>plot_trends(payment,<span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>The graph tracks fee patterns for loans with 60 or more installments from this dataset. Fees generally decrease over time from $50-150 initial amounts, but show sharp spikes likely representing late payment penalties, collection charges, or loan restructuring events. Most loans follow similar declining patterns despite varying terms indicating the end of their loan term.</p>
</section>
</section>
<section id="missing-values" class="level4">
<h4 class="anchored" data-anchor-id="missing-values">2.1.2 Missing Values</h4>
<div id="cell-37" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># missing values for loan.csv</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> missing_values(df):</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>   missingno.matrix(df)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>   plt.title(<span class="st">'Missing Values in Dataset'</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>   plt.show()</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>   missing_pct <span class="op">=</span> df.isnull().<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> <span class="bu">len</span>(df)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> missing_pct.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>missing_values(loan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>originatedDate                      92.029525
fpStatus                            91.046458
clarityFraudId                      38.081332
apr                                  0.678920
loanAmount                           0.389488
payFrequency                         0.220363
loanStatus                           0.067684
loanId                               0.044315
state                                0.022850
nPaidOff                             0.004155
leadCost                             0.000000
leadType                             0.000000
isFunded                             0.000000
originallyScheduledPaymentAmount     0.000000
anon_ssn                             0.000000
approved                             0.000000
originated                           0.000000
applicationDate                      0.000000
hasCF                                0.000000
dtype: float64</code></pre>
</div>
</div>
<div id="cell-38" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>missing_values(clarity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-27-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonetype                           96.954896
.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssnnamereasoncodedescription        94.635392
.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssnnamereasoncode                   94.635392
.underwritingdataclarity.clearfraud.clearfraudidentityverification.nameaddressreasoncodedescription    88.689902
.underwritingdataclarity.clearfraud.clearfraudidentityverification.nameaddressreasoncode               88.689902
.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssndobreasoncode                    81.851986
.underwritingdataclarity.clearfraud.clearfraudindicator.driverlicenseinconsistentwithonfile            79.789757
.underwritingdataclarity.clearfraud.clearfraudindicator.workphonepreviouslylistedashomephone           56.954494
.underwritingdataclarity.clearfraud.clearfraudindicator.workphonepreviouslylistedascellphone           56.954494
.underwritingdataclarity.clearfraud.clearfraudindicator.driverlicenseformatinvalid                     10.148336
.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonematchtype                       1.915501
.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonematchtypedescription            1.915501
.underwritingdataclarity.clearfraud.clearfraudindicator.telephonenumberinconsistentwithstate            1.368789
clearfraudscore                                                                                         0.275366
.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonematchresult                     0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.creditestablishedpriortossnissuedate            0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.creditestablishedbeforeage18                    0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.currentaddressreportedbynewtradeonly            0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.bestonfilessnrecordedasdeceased                 0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.highprobabilityssnbelongstoanother              0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.bestonfilessnissuedatecannotbeverified          0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryaddresshighrisk                          0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.inputssnrecordedasdeceased                      0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.inquirycurrentaddressnotonfile                  0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.morethan3inquiriesinthelast30days               0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.onfileaddresshighrisk                           0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryonfilecurrentaddressconflict             0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.telephonenumberinconsistentwithaddress          0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryageyoungerthanssnissuedate               0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryaddresscautious                          0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryaddressnonresidential                    0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.onfileaddresscautious                           0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.ssnreportedmorefrequentlyforanother             0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.currentaddressreportedbytradeopenlt90days       0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.inputssninvalid                                 0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.inputssnissuedatecannotbeverified               0.080399
.underwritingdataclarity.clearfraud.clearfraudindicator.onfileaddressnonresidential                     0.080399
.underwritingdataclarity.clearfraud.clearfraudidentityverification.overallmatchresult                   0.064319
.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssnnamematch                         0.064319
.underwritingdataclarity.clearfraud.clearfraudidentityverification.nameaddressmatch                     0.064319
.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssndobmatch                          0.064319
.underwritingdataclarity.clearfraud.clearfraudidentityverification.overallmatchreasoncode               0.064319
.underwritingdataclarity.clearfraud.clearfraudindicator.maxnumberofssnswithanybankaccount               0.034169
.underwritingdataclarity.clearfraud.clearfraudindicator.totalnumberoffraudindicators                    0.034169
.underwritingdataclarity.clearfraud.clearfraudinquiry.thirtydaysago                                     0.004020
.underwritingdataclarity.clearfraud.clearfraudinquiry.twentyfourhoursago                                0.004020
.underwritingdataclarity.clearfraud.clearfraudinquiry.threesixtyfivedaysago                             0.004020
.underwritingdataclarity.clearfraud.clearfraudinquiry.fifteendaysago                                    0.004020
.underwritingdataclarity.clearfraud.clearfraudinquiry.tenminutesago                                     0.004020
.underwritingdataclarity.clearfraud.clearfraudinquiry.sevendaysago                                      0.004020
.underwritingdataclarity.clearfraud.clearfraudinquiry.ninetydaysago                                     0.004020
.underwritingdataclarity.clearfraud.clearfraudinquiry.onehourago                                        0.004020
.underwritingdataclarity.clearfraud.clearfraudinquiry.oneminuteago                                      0.004020
underwritingid                                                                                          0.000000
dtype: float64</code></pre>
</div>
</div>
<div id="cell-39" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>missing_values(payment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-28-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>paymentReturnCode    95.425784
paymentStatus        23.798313
loanId                0.000000
installmentIndex      0.000000
isCollection          0.000000
paymentDate           0.000000
principal             0.000000
fees                  0.000000
paymentAmount         0.000000
dtype: float64</code></pre>
</div>
</div>
<p>Unfortunately 4 columns in the dataset have more missing values than not. Before we explore further, we need to understand the pattern of these NA values. Firstly for payment.csv, majority of the missing values lies on the <strong>paymentReturnCode.</strong></p>
<div id="cell-41" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_distinct(df,column):</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    unique_codes <span class="op">=</span> df[column].unique()</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    chunks <span class="op">=</span> [unique_codes[i:i<span class="op">+</span><span class="dv">5</span>] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(unique_codes), <span class="dv">5</span>)]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"-------------- </span><span class="sc">{</span>column<span class="sc">}</span><span class="ss"> --------------"</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> chunk <span class="kw">in</span> chunks:</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"|"</span>, <span class="st">" | "</span>.join(<span class="bu">str</span>(code) <span class="cf">for</span> code <span class="kw">in</span> chunk),<span class="st">"|"</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>print_distinct(payment, <span class="st">'paymentReturnCode'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-------------- paymentReturnCode --------------
| nan | R01 | R08 | R02 | R16 |
| RBW | R03 | R20 | R09 | R10 |
| R07 | C03 | C05 | R06 | R04 |
| R99 | C01 | RXS | C02 | RXL |
| R15 | RAF | RFG | RWC | RIR |
| MISSED | LPP01 | R13 | R29 | R19 |
| RUP | C07 |</code></pre>
</div>
</div>
<div id="cell-42" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>print_distinct(payment,<span class="st">'paymentStatus'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-------------- paymentStatus --------------
| Checked | Rejected | Cancelled | nan | Skipped |
| Returned | Pending | Rejected Awaiting Retry | Complete |</code></pre>
</div>
</div>
<div id="cell-43" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_codes(payment):</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> status <span class="kw">in</span> payment[<span class="st">'paymentStatus'</span>].unique():</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>       count <span class="op">=</span> payment[</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>           (payment[<span class="st">'paymentStatus'</span>] <span class="op">==</span> status) <span class="op">&amp;</span> </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>           (payment[<span class="st">'paymentReturnCode'</span>].notna())</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>       ].shape[<span class="dv">0</span>]</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>       <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>status<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>count_codes(payment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Checked: 241
Rejected: 31290
Cancelled: 1
nan: 0
Skipped: 0
Returned: 1
Pending: 0
Rejected Awaiting Retry: 0
Complete: 0</code></pre>
</div>
</div>
<p>Note that, payment return code only occurs when the paymentStatus is rejected, checked, cancelled, or returned. Resulting in a code which explains the reject. This is a clear example of MAR (Missing At Random). We can fully explain why the data is missing based on paymentStatus. The same goes to originatedDate and fpStatus. originatedDate only exist if the loan has been originated and fpStatus returns NA if no ACH attempt has been made yet according to the data dictionary.</p>
<div id="cell-45" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Count unique loan IDs</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>unique_payment_loans <span class="op">=</span> payment[<span class="st">'loanId'</span>].nunique()</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>unique_loan_loans <span class="op">=</span> loan[<span class="st">'loanId'</span>].nunique()</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top 5 loan frequencies</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>payment_counts <span class="op">=</span> (payment[<span class="st">'loanId'</span>].value_counts()</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>                .reset_index()</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>                .rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'loanId'</span>, <span class="st">'loanId'</span>: <span class="st">'count'</span>})</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>                .head(n))</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>loan_counts <span class="op">=</span> (loan[<span class="st">'loanId'</span>].value_counts()</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>                .reset_index()</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>                .rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'loanId'</span>, <span class="st">'loanId'</span>: <span class="st">'count'</span>})</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>                .head(n))</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Top 5 loan frequencies in payment data:</span><span class="ch">\n</span><span class="sc">{</span>payment_counts<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Top 5 loan frequencies in loan data:</span><span class="ch">\n</span><span class="sc">{</span>loan_counts<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unique loanId in payment.csv: </span><span class="sc">{</span>unique_payment_loans<span class="sc">:,}</span><span class="ss"> out of </span><span class="sc">{</span><span class="bu">len</span>(payment)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unique loanId in loan.csv: </span><span class="sc">{</span>unique_loan_loans<span class="sc">:,}</span><span class="ss"> out of </span><span class="sc">{</span><span class="bu">len</span>(loan)<span class="sc">:,}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Top 5 loan frequencies in payment data:
           count  count
0  LL-I-12230332    105
1  LL-I-08320897    105
2  LL-I-17454600    105
3  LL-I-09757835    105
4  LL-I-12217217    104
5  LL-I-12335887    104
6  LL-I-10000925    104
7  LL-I-10673366    104
8  LL-I-18166243    104
9  LL-I-10265149    104

Top 5 loan frequencies in loan data:
           count  count
0  LL-I-07399092      1
1  LL-I-09120818      1
2  LL-I-12495837      1
3  LL-I-09315207      1
4  LL-I-07105524      1
5  LL-I-08678272      1
6  LL-I-07517765      1
7  LL-I-12108022      1
8  LL-I-06703521      1
9  LL-I-18239150      1

Unique loanId in payment.csv: 39,952 out of 689,364
Unique loanId in loan.csv: 577,426 out of 577,682</code></pre>
</div>
</div>
<p>payment and loan have different amount of rows, notice that payment’s loanID, suggesting that each row does not represent a unique customer. When we try to fit in to the machine learning model, we can’t just summarize either, since installments frequency and other ordinal variable might be a useful feature for our prediction. After joining this data set, we need to seperate those rows to be longer where each row represents one loanId. <strong>Due to this we plan to use an encoding methods</strong> later to fit in the model.</p>
<p>Additionally, it is quite strange that the loanId from loan.csv has different order of values, this might not be loanId at all.</p>
<div id="cell-47" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> loan[<span class="st">'loanId'</span>].notna() <span class="op">&amp;</span> (<span class="op">~</span>loan[<span class="st">'loanId'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.startswith(<span class="st">'LL-I-'</span>))</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>different_ids <span class="op">=</span> loan[mask]</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>different_ids[[<span class="st">'loanId'</span>, <span class="st">'originated'</span>, <span class="st">'loanStatus'</span>, <span class="st">'approved'</span>]]</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loanId</th>
<th data-quarto-table-cell-role="th">originated</th>
<th data-quarto-table-cell-role="th">loanStatus</th>
<th data-quarto-table-cell-role="th">approved</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">12264</td>
<td>LL-T-00260783</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">22497</td>
<td>54bf7e63e4b0606ee9e256f8</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34873</td>
<td>54b1f646e4b06aa735b27461</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">54003</td>
<td>LL-T-03462630</td>
<td>True</td>
<td>External Collection</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">92019</td>
<td>LL-T-00317558</td>
<td>True</td>
<td>External Collection</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">113655</td>
<td>LP-I-00000217</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">117783</td>
<td>LP-I-00000134</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">139375</td>
<td>LP-I-00000145</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">149793</td>
<td>LP-I-00000073</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">161901</td>
<td>LP-I-00000075</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">164992</td>
<td>LP-I-00000082</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">166010</td>
<td>54c13be3e4b0606eea00d977</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">176666</td>
<td>54c5ae5de4b0606eea3a7f79</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">213279</td>
<td>LP-I-00000229</td>
<td>False</td>
<td>Pending Application Fee</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">217443</td>
<td>54c2911ae4b0606eea17ba44</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">220659</td>
<td>54bf5316e4b0606ee9e22fd7</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">224930</td>
<td>LP-I-00000158</td>
<td>False</td>
<td>Pending Application Fee</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">227052</td>
<td>LP-I-00000071</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">228429</td>
<td>LP-I-00000059</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">230554</td>
<td>54c5041fe4b0606eea303fe1</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">250789</td>
<td>54bc36bee4b0ff4c40b4f958</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">252437</td>
<td>54cf4f44e4b0ba763e583495</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">253797</td>
<td>LP-I-00000127</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">254789</td>
<td>LP-I-00000108</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">257884</td>
<td>54bc5f98e4b0ff4c40b67e18</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">293166</td>
<td>LP-I-00000142</td>
<td>True</td>
<td>Customer Voided New Loan</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">298085</td>
<td>LP-I-00000133</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">299154</td>
<td>LP-I-00000193</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">316927</td>
<td>LP-I-00000173</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">318941</td>
<td>LP-I-00000200</td>
<td>False</td>
<td>Pending Application Fee</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">359016</td>
<td>54c22819e4b0606eea0e36e0</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">389404</td>
<td>LP-I-00000141</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">397049</td>
<td>54b71432e4b0fc49086daa02</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">411752</td>
<td>LP-I-00000139</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">427263</td>
<td>LP-I-00000189</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">434562</td>
<td>LP-I-00000030</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">446986</td>
<td>54c50424e4b0606eea30407e</td>
<td>False</td>
<td>Withdrawn Application</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">480873</td>
<td>LP-I-00000029</td>
<td>False</td>
<td>CSR Voided New Loan</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">485533</td>
<td>LP-I-00000112</td>
<td>False</td>
<td>Pending Application Fee</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">493704</td>
<td>LL-T-01984747</td>
<td>True</td>
<td>External Collection</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">520443</td>
<td>LP-I-00000109</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">566283</td>
<td>LP-I-00000061</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">574360</td>
<td>LP-I-00000166</td>
<td>False</td>
<td>Pending Application Fee</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>These id are a result of loanStatus being paid off, withdrawn, pending application, void and external collection.</p>
</section>
<section id="joining-data" class="level4">
<h4 class="anchored" data-anchor-id="joining-data">2.1.3 Joining data</h4>
<div id="cell-49" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>df_merged <span class="op">=</span> (payment.merge(loan, on<span class="op">=</span><span class="st">'loanId'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                  .merge(clarity, </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                        left_on<span class="op">=</span><span class="st">'clarityFraudId'</span>, </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>                        right_on<span class="op">=</span><span class="st">'underwritingid'</span>, </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>                        how<span class="op">=</span><span class="st">'left'</span>))</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display first 5 rows and summary</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"------------------ Joined Data Frame ------------------"</span>)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Joined dataset of loan.csv, payment.csv and clarity_underwriting_variables.csv"</span>)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total Rows: </span><span class="sc">{</span><span class="bu">len</span>(df_merged)<span class="sc">:,}</span><span class="ss">, Total Columns: </span><span class="sc">{</span><span class="bu">len</span>(df_merged.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>df_merged.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------ Joined Data Frame ------------------
Joined dataset of loan.csv, payment.csv and clarity_underwriting_variables.csv
Total Rows: 689,364, Total Columns: 81</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loanId</th>
<th data-quarto-table-cell-role="th">installmentIndex</th>
<th data-quarto-table-cell-role="th">isCollection</th>
<th data-quarto-table-cell-role="th">paymentDate</th>
<th data-quarto-table-cell-role="th">principal</th>
<th data-quarto-table-cell-role="th">fees</th>
<th data-quarto-table-cell-role="th">paymentAmount</th>
<th data-quarto-table-cell-role="th">paymentStatus</th>
<th data-quarto-table-cell-role="th">paymentReturnCode</th>
<th data-quarto-table-cell-role="th">anon_ssn</th>
<th data-quarto-table-cell-role="th">payFrequency</th>
<th data-quarto-table-cell-role="th">apr</th>
<th data-quarto-table-cell-role="th">applicationDate</th>
<th data-quarto-table-cell-role="th">originated</th>
<th data-quarto-table-cell-role="th">originatedDate</th>
<th data-quarto-table-cell-role="th">nPaidOff</th>
<th data-quarto-table-cell-role="th">approved</th>
<th data-quarto-table-cell-role="th">isFunded</th>
<th data-quarto-table-cell-role="th">loanStatus</th>
<th data-quarto-table-cell-role="th">loanAmount</th>
<th data-quarto-table-cell-role="th">originallyScheduledPaymentAmount</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">leadType</th>
<th data-quarto-table-cell-role="th">leadCost</th>
<th data-quarto-table-cell-role="th">fpStatus</th>
<th data-quarto-table-cell-role="th">clarityFraudId</th>
<th data-quarto-table-cell-role="th">hasCF</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudinquiry.thirtydaysago</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudinquiry.twentyfourhoursago</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudinquiry.oneminuteago</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudinquiry.onehourago</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudinquiry.ninetydaysago</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudinquiry.sevendaysago</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudinquiry.tenminutesago</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudinquiry.fifteendaysago</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudinquiry.threesixtyfivedaysago</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryonfilecurrentaddressconflict</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.totalnumberoffraudindicators</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.telephonenumberinconsistentwithaddress</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryageyoungerthanssnissuedate</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.onfileaddresscautious</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryaddressnonresidential</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.onfileaddresshighrisk</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.ssnreportedmorefrequentlyforanother</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.currentaddressreportedbytradeopenlt90days</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.inputssninvalid</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.inputssnissuedatecannotbeverified</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryaddresscautious</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.morethan3inquiriesinthelast30days</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.onfileaddressnonresidential</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.creditestablishedpriortossnissuedate</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.driverlicenseformatinvalid</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.inputssnrecordedasdeceased</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryaddresshighrisk</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.inquirycurrentaddressnotonfile</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.bestonfilessnissuedatecannotbeverified</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.highprobabilityssnbelongstoanother</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.maxnumberofssnswithanybankaccount</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.bestonfilessnrecordedasdeceased</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.currentaddressreportedbynewtradeonly</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.creditestablishedbeforeage18</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.telephonenumberinconsistentwithstate</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.driverlicenseinconsistentwithonfile</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.workphonepreviouslylistedascellphone</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudindicator.workphonepreviouslylistedashomephone</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssnnamematch</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudidentityverification.nameaddressmatch</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonematchtype</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssnnamereasoncodedescription</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonematchresult</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudidentityverification.nameaddressreasoncodedescription</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonematchtypedescription</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudidentityverification.overallmatchresult</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonetype</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssndobreasoncode</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssnnamereasoncode</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudidentityverification.nameaddressreasoncode</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssndobmatch</th>
<th data-quarto-table-cell-role="th">.underwritingdataclarity.clearfraud.clearfraudidentityverification.overallmatchreasoncode</th>
<th data-quarto-table-cell-role="th">clearfraudscore</th>
<th data-quarto-table-cell-role="th">underwritingid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>LL-I-00000021</td>
<td>1</td>
<td>False</td>
<td>2014-12-19T05:00:00</td>
<td>22.33</td>
<td>147.28</td>
<td>169.61</td>
<td>Checked</td>
<td>NaN</td>
<td>3e02899b53aa4877f9823b8ed5d5a6f1</td>
<td>B</td>
<td>478.67</td>
<td>2014-12-03T00:31:22.306000</td>
<td>True</td>
<td>2014-12-03T03:12:58.466000</td>
<td>NaN</td>
<td>True</td>
<td>1</td>
<td>Settlement Paid Off</td>
<td>800.0</td>
<td>2035.32</td>
<td>OH</td>
<td>lead</td>
<td>25</td>
<td>Checked</td>
<td>NaN</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>LL-I-00000021</td>
<td>2</td>
<td>False</td>
<td>2015-01-02T05:00:00</td>
<td>26.44</td>
<td>143.17</td>
<td>169.61</td>
<td>Checked</td>
<td>NaN</td>
<td>3e02899b53aa4877f9823b8ed5d5a6f1</td>
<td>B</td>
<td>478.67</td>
<td>2014-12-03T00:31:22.306000</td>
<td>True</td>
<td>2014-12-03T03:12:58.466000</td>
<td>NaN</td>
<td>True</td>
<td>1</td>
<td>Settlement Paid Off</td>
<td>800.0</td>
<td>2035.32</td>
<td>OH</td>
<td>lead</td>
<td>25</td>
<td>Checked</td>
<td>NaN</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>LL-I-00000021</td>
<td>3</td>
<td>False</td>
<td>2015-01-16T05:00:00</td>
<td>31.30</td>
<td>138.31</td>
<td>169.61</td>
<td>Checked</td>
<td>NaN</td>
<td>3e02899b53aa4877f9823b8ed5d5a6f1</td>
<td>B</td>
<td>478.67</td>
<td>2014-12-03T00:31:22.306000</td>
<td>True</td>
<td>2014-12-03T03:12:58.466000</td>
<td>NaN</td>
<td>True</td>
<td>1</td>
<td>Settlement Paid Off</td>
<td>800.0</td>
<td>2035.32</td>
<td>OH</td>
<td>lead</td>
<td>25</td>
<td>Checked</td>
<td>NaN</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>LL-I-00000021</td>
<td>4</td>
<td>False</td>
<td>2015-01-30T05:00:00</td>
<td>37.07</td>
<td>132.54</td>
<td>169.61</td>
<td>Checked</td>
<td>NaN</td>
<td>3e02899b53aa4877f9823b8ed5d5a6f1</td>
<td>B</td>
<td>478.67</td>
<td>2014-12-03T00:31:22.306000</td>
<td>True</td>
<td>2014-12-03T03:12:58.466000</td>
<td>NaN</td>
<td>True</td>
<td>1</td>
<td>Settlement Paid Off</td>
<td>800.0</td>
<td>2035.32</td>
<td>OH</td>
<td>lead</td>
<td>25</td>
<td>Checked</td>
<td>NaN</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>LL-I-00000021</td>
<td>5</td>
<td>False</td>
<td>2015-02-13T05:00:00</td>
<td>43.89</td>
<td>125.72</td>
<td>169.61</td>
<td>Checked</td>
<td>NaN</td>
<td>3e02899b53aa4877f9823b8ed5d5a6f1</td>
<td>B</td>
<td>478.67</td>
<td>2014-12-03T00:31:22.306000</td>
<td>True</td>
<td>2014-12-03T03:12:58.466000</td>
<td>NaN</td>
<td>True</td>
<td>1</td>
<td>Settlement Paid Off</td>
<td>800.0</td>
<td>2035.32</td>
<td>OH</td>
<td>lead</td>
<td>25</td>
<td>Checked</td>
<td>NaN</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Before we can explore further on this dataset, we want to know if there are any missing values.</p>
<p>Additionally, we want to assess whether this join is successful or not</p>
<div id="cell-51" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_missing():</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Calculate missing percentages</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>   missing_pct <span class="op">=</span> (df_merged.isnull().mean() <span class="op">*</span> <span class="dv">100</span>).reset_index()</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>   missing_pct.columns <span class="op">=</span> [<span class="st">'variable'</span>, <span class="st">'percent_missing'</span>]</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Calculate missing counts</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>   missing_counts <span class="op">=</span> df_merged.isnull().<span class="bu">sum</span>().reset_index()</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>   missing_counts.columns <span class="op">=</span> [<span class="st">'variable'</span>, <span class="st">'n_missing'</span>]</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Combine and calculate not missing</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>   missing_stats <span class="op">=</span> missing_counts.merge(missing_pct, on<span class="op">=</span><span class="st">'variable'</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>   missing_stats[<span class="st">'not_missing'</span>] <span class="op">=</span> <span class="bu">len</span>(df_merged) <span class="op">-</span> missing_stats[<span class="st">'n_missing'</span>]</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Filter and sort</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>   missing_stats <span class="op">=</span> missing_stats[missing_stats[<span class="st">'percent_missing'</span>] <span class="op">&gt;</span> <span class="dv">0</span>].sort_values(</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>       <span class="st">'percent_missing'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>   missing_stats[<span class="st">'percent_missing'</span>] <span class="op">=</span> missing_stats[<span class="st">'percent_missing'</span>].<span class="bu">round</span>(<span class="dv">5</span>)</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> missing_stats</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>check_missing()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">variable</th>
<th data-quarto-table-cell-role="th">n_missing</th>
<th data-quarto-table-cell-role="th">percent_missing</th>
<th data-quarto-table-cell-role="th">not_missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">73</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>672458</td>
<td>97.54759</td>
<td>16906</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">75</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>660177</td>
<td>95.76610</td>
<td>29187</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">68</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>660177</td>
<td>95.76610</td>
<td>29187</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>paymentReturnCode</td>
<td>657831</td>
<td>95.42578</td>
<td>31533</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">76</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>626264</td>
<td>90.84664</td>
<td>63100</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">70</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>626264</td>
<td>90.84664</td>
<td>63100</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">74</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>584855</td>
<td>84.83979</td>
<td>104509</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">62</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>579656</td>
<td>84.08562</td>
<td>109708</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">64</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>419967</td>
<td>60.92094</td>
<td>269397</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">63</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>419967</td>
<td>60.92094</td>
<td>269397</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">51</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>196965</td>
<td>28.57199</td>
<td>492399</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>paymentStatus</td>
<td>164057</td>
<td>23.79831</td>
<td>525307</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">67</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>141576</td>
<td>20.53719</td>
<td>547788</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">71</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>141576</td>
<td>20.53719</td>
<td>547788</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">61</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>138708</td>
<td>20.12116</td>
<td>550656</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">79</td>
<td>clearfraudscore</td>
<td>132637</td>
<td>19.24049</td>
<td>556727</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">60</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">59</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">58</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">56</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">55</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">69</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">49</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">47</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">39</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">46</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">42</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">44</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">45</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131618</td>
<td>19.09267</td>
<td>557746</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">77</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131477</td>
<td>19.07222</td>
<td>557887</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">72</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131477</td>
<td>19.07222</td>
<td>557887</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">78</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131477</td>
<td>19.07222</td>
<td>557887</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">65</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131477</td>
<td>19.07222</td>
<td>557887</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">66</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131477</td>
<td>19.07222</td>
<td>557887</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">37</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131281</td>
<td>19.04379</td>
<td>558083</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">57</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131281</td>
<td>19.04379</td>
<td>558083</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131062</td>
<td>19.01202</td>
<td>558302</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131062</td>
<td>19.01202</td>
<td>558302</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131062</td>
<td>19.01202</td>
<td>558302</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131062</td>
<td>19.01202</td>
<td>558302</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131062</td>
<td>19.01202</td>
<td>558302</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131062</td>
<td>19.01202</td>
<td>558302</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131062</td>
<td>19.01202</td>
<td>558302</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">32</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131062</td>
<td>19.01202</td>
<td>558302</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35</td>
<td>.underwritingdataclarity.clearfraud.clearfraud...</td>
<td>131062</td>
<td>19.01202</td>
<td>558302</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">80</td>
<td>underwritingid</td>
<td>131038</td>
<td>19.00854</td>
<td>558326</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25</td>
<td>clarityFraudId</td>
<td>115552</td>
<td>16.76212</td>
<td>573812</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>fpStatus</td>
<td>17706</td>
<td>2.56845</td>
<td>671658</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>nPaidOff</td>
<td>383</td>
<td>0.05556</td>
<td>688981</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>originatedDate</td>
<td>269</td>
<td>0.03902</td>
<td>689095</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>it seems the initial fraud screening has 19-20% missing values while clear fraud identity verification has missing rates of 95-97% implying this is a result of selective verfication process based on risk assessment needs. Due to this we plan to not include all the variables for the model as the high NA values might add white noise to the model. Although, the clarity underwriting values that we’ll prioritize is:</p>
<ul>
<li><p>clearFraudScore (measure overall fraud risk)</p></li>
<li><p>totalnumberoffraudindicators (aggregate fraud signals)</p></li>
<li><p>clearfraudinquiry (inquiries of n-th times ago)</p></li>
<li><p>ssnnamematch (verify identity)</p></li>
<li><p>nameaddressmatch (address verification)</p></li>
<li><p>overallmatchresult (combined verficiation score)</p></li>
<li><p>creditestablishedbeforeage18 (potential fraud)</p></li>
<li><p>currentaddressreportedbynewtradeonly (suspicious signal)</p></li>
<li><p>morethan3inquiriesinthelast30days (shows desperation)</p></li>
<li><p>inputssninvalid (basic fraud check)</p></li>
</ul>
</section>
</section>
<section id="determining-the-dependent-variable." class="level3">
<h3 class="anchored" data-anchor-id="determining-the-dependent-variable.">2.2 Determining the dependent variable.</h3>
<div id="cell-53" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>print_distinct(payment,<span class="st">'paymentStatus'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-------------- paymentStatus --------------
| Checked | Rejected | Cancelled | nan | Skipped |
| Returned | Pending | Rejected Awaiting Retry | Complete |</code></pre>
</div>
</div>
<p>After the exploratory data analysis, <strong>PaymentStatus</strong> would be the ideal dependent variable for predicting loan risk. This because it captures the complete process of loan performance. Payment status have no NA values and updates throughout the loan term. Additionally, paymentstatus reveals the 9 indicators of loan progression from “Checked” to “Complete”. This variable aligns perfectly with the business context where it is a measure of the applicant’s behaviour and the loan’s health.</p>
</section>
</section>
<section id="feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering">3. Feature Engineering</h2>
<p>Our goal here is to reduce dimensionality and create a better predictive power. realistically, we’d implement the use of a white box model. That is because we plan to create a model that can still be interpret rather than being highly accurate. To compensate on predictive power, we want the model to be explainable due to financial regulations prefer our fraud prediction to be transparent for fair lending practices, regulatory compliance, model validation and customer explanation requirements.</p>
<p>However, for this analysis purpose we will try to explore both black and white box model as our comparison to see how much predictive power have we trade off for interpretability.</p>
<section id="selecting-useful-inputs" class="level3">
<h3 class="anchored" data-anchor-id="selecting-useful-inputs">3.1 Selecting Useful Inputs</h3>
<p>For the maching learning model to work, we wanted to delete any redundant variables that will not be useful for prediction. This include, ID , highly correlated variables (principal and fees with payment amount) and dates. We also wanted to remove state as that might introduce regional bias. Although, we plan to keep the loanID to aggregate the columns later.</p>
<div id="cell-55" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Select initial features</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>selected_cols <span class="op">=</span> [</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'loanId'</span>, <span class="st">'paymentStatus'</span>, <span class="st">'installmentIndex'</span>, <span class="st">'isCollection'</span>,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'principal'</span>, <span class="st">'fees'</span>, <span class="st">'paymentReturnCode'</span>, <span class="st">'payFrequency'</span>, <span class="st">'apr'</span>,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'isFunded'</span>, <span class="st">'approved'</span>, <span class="st">'loanAmount'</span>, <span class="st">'originallyScheduledPaymentAmount'</span>,</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'nPaidOff'</span>, <span class="st">'originated'</span>, <span class="st">'loanStatus'</span>, <span class="st">'leadType'</span>, <span class="st">'fpStatus'</span>,</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'clearfraudscore'</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Clarity columns -&gt; underwriting variables that we belive to be useful</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>fraud_patterns <span class="op">=</span> [</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'clearfraudinquiry'</span>, <span class="st">'creditestablishedbeforeage18'</span>, <span class="st">'ssnnamematch'</span>,</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'currentaddressreportedbynewtradeonly'</span>, <span class="st">'morethan3inquiriesinthelast30days'</span>,</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'overallmatchresult'</span>, <span class="st">'totalnumberoffraudindicators'</span>, <span class="st">'inputssninvalid'</span>,</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'nameaddressmatch'</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pattern <span class="kw">in</span> fraud_patterns:</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>    pattern_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df_merged.columns <span class="cf">if</span> pattern <span class="kw">in</span> col.lower()]</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>    selected_cols.extend(pattern_cols)</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>df_feature <span class="op">=</span> df_merged[selected_cols].copy()</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns by taking last part after dot</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>rename_dict <span class="op">=</span> {col: col.split(<span class="st">'.'</span>)[<span class="op">-</span><span class="dv">1</span>] <span class="cf">for</span> col <span class="kw">in</span> df_feature.columns <span class="cf">if</span> <span class="st">'.'</span> <span class="kw">in</span> col}</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>df_feature <span class="op">=</span> df_feature.rename(columns<span class="op">=</span>rename_dict)</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Columns: </span><span class="sc">{</span><span class="bu">len</span>(df_feature.columns)<span class="sc">}</span><span class="ss">, Rows: </span><span class="sc">{</span><span class="bu">len</span>(df_feature)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>df_feature.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Columns: 36, Rows: 689,364</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loanId</th>
<th data-quarto-table-cell-role="th">paymentStatus</th>
<th data-quarto-table-cell-role="th">installmentIndex</th>
<th data-quarto-table-cell-role="th">isCollection</th>
<th data-quarto-table-cell-role="th">principal</th>
<th data-quarto-table-cell-role="th">fees</th>
<th data-quarto-table-cell-role="th">paymentReturnCode</th>
<th data-quarto-table-cell-role="th">payFrequency</th>
<th data-quarto-table-cell-role="th">apr</th>
<th data-quarto-table-cell-role="th">isFunded</th>
<th data-quarto-table-cell-role="th">approved</th>
<th data-quarto-table-cell-role="th">loanAmount</th>
<th data-quarto-table-cell-role="th">originallyScheduledPaymentAmount</th>
<th data-quarto-table-cell-role="th">nPaidOff</th>
<th data-quarto-table-cell-role="th">originated</th>
<th data-quarto-table-cell-role="th">loanStatus</th>
<th data-quarto-table-cell-role="th">leadType</th>
<th data-quarto-table-cell-role="th">fpStatus</th>
<th data-quarto-table-cell-role="th">clearfraudscore</th>
<th data-quarto-table-cell-role="th">thirtydaysago</th>
<th data-quarto-table-cell-role="th">twentyfourhoursago</th>
<th data-quarto-table-cell-role="th">oneminuteago</th>
<th data-quarto-table-cell-role="th">onehourago</th>
<th data-quarto-table-cell-role="th">ninetydaysago</th>
<th data-quarto-table-cell-role="th">sevendaysago</th>
<th data-quarto-table-cell-role="th">tenminutesago</th>
<th data-quarto-table-cell-role="th">fifteendaysago</th>
<th data-quarto-table-cell-role="th">threesixtyfivedaysago</th>
<th data-quarto-table-cell-role="th">creditestablishedbeforeage18</th>
<th data-quarto-table-cell-role="th">ssnnamematch</th>
<th data-quarto-table-cell-role="th">currentaddressreportedbynewtradeonly</th>
<th data-quarto-table-cell-role="th">morethan3inquiriesinthelast30days</th>
<th data-quarto-table-cell-role="th">overallmatchresult</th>
<th data-quarto-table-cell-role="th">totalnumberoffraudindicators</th>
<th data-quarto-table-cell-role="th">inputssninvalid</th>
<th data-quarto-table-cell-role="th">nameaddressmatch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>LL-I-00000021</td>
<td>Checked</td>
<td>1</td>
<td>False</td>
<td>22.33</td>
<td>147.28</td>
<td>NaN</td>
<td>B</td>
<td>478.67</td>
<td>1</td>
<td>True</td>
<td>800.0</td>
<td>2035.32</td>
<td>NaN</td>
<td>True</td>
<td>Settlement Paid Off</td>
<td>lead</td>
<td>Checked</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>LL-I-00000021</td>
<td>Checked</td>
<td>2</td>
<td>False</td>
<td>26.44</td>
<td>143.17</td>
<td>NaN</td>
<td>B</td>
<td>478.67</td>
<td>1</td>
<td>True</td>
<td>800.0</td>
<td>2035.32</td>
<td>NaN</td>
<td>True</td>
<td>Settlement Paid Off</td>
<td>lead</td>
<td>Checked</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>LL-I-00000021</td>
<td>Checked</td>
<td>3</td>
<td>False</td>
<td>31.30</td>
<td>138.31</td>
<td>NaN</td>
<td>B</td>
<td>478.67</td>
<td>1</td>
<td>True</td>
<td>800.0</td>
<td>2035.32</td>
<td>NaN</td>
<td>True</td>
<td>Settlement Paid Off</td>
<td>lead</td>
<td>Checked</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>LL-I-00000021</td>
<td>Checked</td>
<td>4</td>
<td>False</td>
<td>37.07</td>
<td>132.54</td>
<td>NaN</td>
<td>B</td>
<td>478.67</td>
<td>1</td>
<td>True</td>
<td>800.0</td>
<td>2035.32</td>
<td>NaN</td>
<td>True</td>
<td>Settlement Paid Off</td>
<td>lead</td>
<td>Checked</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>LL-I-00000021</td>
<td>Checked</td>
<td>5</td>
<td>False</td>
<td>43.89</td>
<td>125.72</td>
<td>NaN</td>
<td>B</td>
<td>478.67</td>
<td>1</td>
<td>True</td>
<td>800.0</td>
<td>2035.32</td>
<td>NaN</td>
<td>True</td>
<td>Settlement Paid Off</td>
<td>lead</td>
<td>Checked</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-56" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_corr():</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>   df_num <span class="op">=</span> df_feature.select_dtypes(include<span class="op">=</span>[<span class="st">'float64'</span>, <span class="st">'int64'</span>]).dropna() </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>   df_num.columns <span class="op">=</span> [col[:<span class="dv">10</span>] <span class="cf">for</span> col <span class="kw">in</span> df_num.columns]</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>   corr <span class="op">=</span> df_num.corr()</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>   plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>   sns.heatmap(corr, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.2f'</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>   plt.tight_layout()</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> plt.show()</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>plot_corr()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-38-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This correlation matrix present correlation challenges for the model. High multicollineaity between time variables might need to be aggregated to prevent redundancy. Creating ratio features would probably be efficient. But for now, let’s just select one to simplify this model, we’d select fifteendaysago. For the installment index, as discussed previously in data preprocessing stage we plan to implement an encoding methods to aggregate the data.</p>
</section>
<section id="missing-values-by-removal" class="level3">
<h3 class="anchored" data-anchor-id="missing-values-by-removal">3.2 Missing Values by removal</h3>
<div id="cell-58" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>missing_values(df_feature)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>paymentReturnCode                       95.425784
paymentStatus                           23.798313
clearfraudscore                         19.240488
inputssninvalid                         19.092671
morethan3inquiriesinthelast30days       19.092671
currentaddressreportedbynewtradeonly    19.092671
creditestablishedbeforeage18            19.092671
overallmatchresult                      19.072217
ssnnamematch                            19.072217
nameaddressmatch                        19.072217
totalnumberoffraudindicators            19.043785
ninetydaysago                           19.012017
twentyfourhoursago                      19.012017
fifteendaysago                          19.012017
tenminutesago                           19.012017
sevendaysago                            19.012017
onehourago                              19.012017
oneminuteago                            19.012017
thirtydaysago                           19.012017
threesixtyfivedaysago                   19.012017
fpStatus                                 2.568454
nPaidOff                                 0.055558
apr                                      0.000000
fees                                     0.000000
principal                                0.000000
payFrequency                             0.000000
isCollection                             0.000000
installmentIndex                         0.000000
approved                                 0.000000
loanAmount                               0.000000
isFunded                                 0.000000
leadType                                 0.000000
loanStatus                               0.000000
originated                               0.000000
originallyScheduledPaymentAmount         0.000000
loanId                                   0.000000
dtype: float64</code></pre>
</div>
</div>
<p>If we want to filter the data we need to make sure the missing data is Missing Completely At Random (MCAR) so it wont create selection bias, hoping this missingness doesn’t correlate with important outcomes. Additionally the payment return code has 95% missing values, it is better to completely drop them. The fraud indicators likely to be Missing At Random (MAR) or Missing Not At Random (MNAR) as the missing visualization shows consistent pattern. to double check, this data is a result of joining three tables. Hence, let’s visualize the clarity fraud id with clearfraudscore on the previous joined dataset. However, nPaidoff has &lt;0.1% missing values hence, the impact on the dataset size will be minimal since the remaining 99.9% provides sufficient information.</p>
<div id="cell-60" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>missing_values(df_merged[[<span class="st">'clarityFraudId'</span>, <span class="st">'clearfraudscore'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>clearfraudscore    19.240488
clarityFraudId     16.762117
dtype: float64</code></pre>
</div>
</div>
<p>it seems that the missing values from clarity fraud id and clearfraudscore is not align. Meaning this is not because their clarity ID does not exist. However, we can remove the fraud indicators when there isn’t any clarity fraud id while the indicator with present fraud id will be imputed using K-Nearest Neighbor.</p>
<div id="cell-62" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>imputed <span class="op">=</span> df_feature.copy()</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>imputed <span class="op">=</span> imputed.drop(columns<span class="op">=</span>[<span class="st">'paymentReturnCode'</span>])</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out null values in key columns</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>df_impute <span class="op">=</span> imputed[imputed[<span class="st">'nPaidOff'</span>].notna()]</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>missing_values(df_impute)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-41-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>paymentStatus                           23.795141
clearfraudscore                         19.200529
inputssninvalid                         19.052630
morethan3inquiriesinthelast30days       19.052630
currentaddressreportedbynewtradeonly    19.052630
creditestablishedbeforeage18            19.052630
overallmatchresult                      19.032165
ssnnamematch                            19.032165
nameaddressmatch                        19.032165
totalnumberoffraudindicators            19.003717
ninetydaysago                           18.971931
thirtydaysago                           18.971931
tenminutesago                           18.971931
sevendaysago                            18.971931
onehourago                              18.971931
oneminuteago                            18.971931
twentyfourhoursago                      18.971931
fifteendaysago                          18.971931
threesixtyfivedaysago                   18.971931
fpStatus                                 2.569882
fees                                     0.000000
principal                                0.000000
apr                                      0.000000
isCollection                             0.000000
installmentIndex                         0.000000
payFrequency                             0.000000
approved                                 0.000000
loanAmount                               0.000000
isFunded                                 0.000000
leadType                                 0.000000
loanStatus                               0.000000
originated                               0.000000
nPaidOff                                 0.000000
originallyScheduledPaymentAmount         0.000000
loanId                                   0.000000
dtype: float64</code></pre>
</div>
</div>
<p>Fortunately, at this point the dataset is small enough to be deleted. We still have sufficient information with the remaining variable. Otherwise, we do not want the imputated data to mess with the model.</p>
<div id="cell-64" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>df_impute <span class="op">=</span> df_impute.dropna()</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>columns_to_drop <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df_impute.columns <span class="cf">if</span> col.endswith(<span class="st">'ago'</span>) <span class="kw">and</span> col <span class="op">!=</span> <span class="st">'fifteendaysago'</span>]</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>df_impute <span class="op">=</span> df_impute.drop(columns<span class="op">=</span>columns_to_drop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-65" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>df_impute</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loanId</th>
<th data-quarto-table-cell-role="th">paymentStatus</th>
<th data-quarto-table-cell-role="th">installmentIndex</th>
<th data-quarto-table-cell-role="th">isCollection</th>
<th data-quarto-table-cell-role="th">principal</th>
<th data-quarto-table-cell-role="th">fees</th>
<th data-quarto-table-cell-role="th">payFrequency</th>
<th data-quarto-table-cell-role="th">apr</th>
<th data-quarto-table-cell-role="th">isFunded</th>
<th data-quarto-table-cell-role="th">approved</th>
<th data-quarto-table-cell-role="th">loanAmount</th>
<th data-quarto-table-cell-role="th">originallyScheduledPaymentAmount</th>
<th data-quarto-table-cell-role="th">nPaidOff</th>
<th data-quarto-table-cell-role="th">originated</th>
<th data-quarto-table-cell-role="th">loanStatus</th>
<th data-quarto-table-cell-role="th">leadType</th>
<th data-quarto-table-cell-role="th">fpStatus</th>
<th data-quarto-table-cell-role="th">clearfraudscore</th>
<th data-quarto-table-cell-role="th">fifteendaysago</th>
<th data-quarto-table-cell-role="th">creditestablishedbeforeage18</th>
<th data-quarto-table-cell-role="th">ssnnamematch</th>
<th data-quarto-table-cell-role="th">currentaddressreportedbynewtradeonly</th>
<th data-quarto-table-cell-role="th">morethan3inquiriesinthelast30days</th>
<th data-quarto-table-cell-role="th">overallmatchresult</th>
<th data-quarto-table-cell-role="th">totalnumberoffraudindicators</th>
<th data-quarto-table-cell-role="th">inputssninvalid</th>
<th data-quarto-table-cell-role="th">nameaddressmatch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">5957</td>
<td>LL-I-00202645</td>
<td>Checked</td>
<td>1</td>
<td>False</td>
<td>0.00</td>
<td>31.56</td>
<td>W</td>
<td>478.67</td>
<td>1</td>
<td>True</td>
<td>600.0</td>
<td>1463.49</td>
<td>0.0</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>768.0</td>
<td>5.0</td>
<td>False</td>
<td>match</td>
<td>False</td>
<td>False</td>
<td>match</td>
<td>1.0</td>
<td>False</td>
<td>match</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5958</td>
<td>LL-I-00202645</td>
<td>Checked</td>
<td>2</td>
<td>False</td>
<td>8.40</td>
<td>55.23</td>
<td>W</td>
<td>478.67</td>
<td>1</td>
<td>True</td>
<td>600.0</td>
<td>1463.49</td>
<td>0.0</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>768.0</td>
<td>5.0</td>
<td>False</td>
<td>match</td>
<td>False</td>
<td>False</td>
<td>match</td>
<td>1.0</td>
<td>False</td>
<td>match</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5959</td>
<td>LL-I-00202645</td>
<td>Checked</td>
<td>3</td>
<td>False</td>
<td>9.17</td>
<td>54.46</td>
<td>W</td>
<td>478.67</td>
<td>1</td>
<td>True</td>
<td>600.0</td>
<td>1463.49</td>
<td>0.0</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>768.0</td>
<td>5.0</td>
<td>False</td>
<td>match</td>
<td>False</td>
<td>False</td>
<td>match</td>
<td>1.0</td>
<td>False</td>
<td>match</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5960</td>
<td>LL-I-00202645</td>
<td>Checked</td>
<td>4</td>
<td>False</td>
<td>572.41</td>
<td>0.00</td>
<td>W</td>
<td>478.67</td>
<td>1</td>
<td>True</td>
<td>600.0</td>
<td>1463.49</td>
<td>0.0</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>768.0</td>
<td>5.0</td>
<td>False</td>
<td>match</td>
<td>False</td>
<td>False</td>
<td>match</td>
<td>1.0</td>
<td>False</td>
<td>match</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5961</td>
<td>LL-I-00202645</td>
<td>Cancelled</td>
<td>5</td>
<td>False</td>
<td>10.02</td>
<td>53.61</td>
<td>W</td>
<td>478.67</td>
<td>1</td>
<td>True</td>
<td>600.0</td>
<td>1463.49</td>
<td>0.0</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>768.0</td>
<td>5.0</td>
<td>False</td>
<td>match</td>
<td>False</td>
<td>False</td>
<td>match</td>
<td>1.0</td>
<td>False</td>
<td>match</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">685598</td>
<td>LL-I-18518246</td>
<td>Cancelled</td>
<td>9</td>
<td>False</td>
<td>100.06</td>
<td>177.66</td>
<td>S</td>
<td>645.00</td>
<td>1</td>
<td>True</td>
<td>1000.0</td>
<td>3332.75</td>
<td>0.0</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>694.0</td>
<td>6.0</td>
<td>False</td>
<td>match</td>
<td>False</td>
<td>False</td>
<td>match</td>
<td>2.0</td>
<td>False</td>
<td>match</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">685599</td>
<td>LL-I-18518246</td>
<td>Cancelled</td>
<td>10</td>
<td>False</td>
<td>92.05</td>
<td>185.67</td>
<td>S</td>
<td>645.00</td>
<td>1</td>
<td>True</td>
<td>1000.0</td>
<td>3332.75</td>
<td>0.0</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>694.0</td>
<td>6.0</td>
<td>False</td>
<td>match</td>
<td>False</td>
<td>False</td>
<td>match</td>
<td>2.0</td>
<td>False</td>
<td>match</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">685600</td>
<td>LL-I-18518246</td>
<td>Cancelled</td>
<td>11</td>
<td>False</td>
<td>138.29</td>
<td>139.43</td>
<td>S</td>
<td>645.00</td>
<td>1</td>
<td>True</td>
<td>1000.0</td>
<td>3332.75</td>
<td>0.0</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>694.0</td>
<td>6.0</td>
<td>False</td>
<td>match</td>
<td>False</td>
<td>False</td>
<td>match</td>
<td>2.0</td>
<td>False</td>
<td>match</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">685601</td>
<td>LL-I-18518246</td>
<td>Cancelled</td>
<td>12</td>
<td>False</td>
<td>168.10</td>
<td>109.62</td>
<td>S</td>
<td>645.00</td>
<td>1</td>
<td>True</td>
<td>1000.0</td>
<td>3332.75</td>
<td>0.0</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>694.0</td>
<td>6.0</td>
<td>False</td>
<td>match</td>
<td>False</td>
<td>False</td>
<td>match</td>
<td>2.0</td>
<td>False</td>
<td>match</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">685602</td>
<td>LL-I-18518246</td>
<td>Cancelled</td>
<td>13</td>
<td>False</td>
<td>219.62</td>
<td>58.21</td>
<td>S</td>
<td>645.00</td>
<td>1</td>
<td>True</td>
<td>1000.0</td>
<td>3332.75</td>
<td>0.0</td>
<td>True</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>694.0</td>
<td>6.0</td>
<td>False</td>
<td>match</td>
<td>False</td>
<td>False</td>
<td>match</td>
<td>2.0</td>
<td>False</td>
<td>match</td>
</tr>
</tbody>
</table>

<p>423402 rows × 27 columns</p>
</div>
</div>
</div>
<p>Alright, now on to the encoding methods…</p>
</section>
<section id="encoding-methods" class="level3">
<h3 class="anchored" data-anchor-id="encoding-methods">3.2 Encoding Methods</h3>
<p>Now before we continue further, there are two ways this could work. If we retain all the long information from payment.csv which allows the same loanId to be present untill all installment index, Or we derive them sequentially and create a weighted risk level assessment. From here lets create the function we need and then we try to do both.</p>
<section id="i0-binary-encoding" class="level4">
<h4 class="anchored" data-anchor-id="i0-binary-encoding">I/0 Binary Encoding</h4>
<div id="cell-67" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>categorical <span class="op">=</span> [<span class="st">'paymentStatus'</span>, <span class="st">'payFrequency'</span>, <span class="st">'loanStatus'</span>, <span class="st">'leadType'</span>, <span class="st">'fpStatus'</span>, <span class="st">'ssnnamematch'</span>, <span class="st">'overallmatchresult'</span>, <span class="st">'nameaddressmatch'</span>]</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>binary <span class="op">=</span> [<span class="st">'isCollection'</span>, <span class="st">'approved'</span>, <span class="st">'originated'</span>, <span class="st">'creditestablishedbeforeage18'</span>,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">'currentaddressreportedbynewtradeonly'</span>, <span class="st">'morethan3inquiriesinthelast30days'</span>,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">'inputssninvalid'</span>]</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encode binary columns</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> pd.get_dummies(df_impute, columns<span class="op">=</span>binary, drop_first<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>bool_columns <span class="op">=</span> df_encoded.select_dtypes(include<span class="op">=</span>[<span class="st">'bool'</span>]).columns</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert boolean to 0/1 integers</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> bool_columns:</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>   df_encoded[col] <span class="op">=</span> df_encoded[col].astype(<span class="bu">int</span>)</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>df_encoded</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loanId</th>
<th data-quarto-table-cell-role="th">paymentStatus</th>
<th data-quarto-table-cell-role="th">installmentIndex</th>
<th data-quarto-table-cell-role="th">principal</th>
<th data-quarto-table-cell-role="th">fees</th>
<th data-quarto-table-cell-role="th">payFrequency</th>
<th data-quarto-table-cell-role="th">apr</th>
<th data-quarto-table-cell-role="th">isFunded</th>
<th data-quarto-table-cell-role="th">loanAmount</th>
<th data-quarto-table-cell-role="th">originallyScheduledPaymentAmount</th>
<th data-quarto-table-cell-role="th">nPaidOff</th>
<th data-quarto-table-cell-role="th">loanStatus</th>
<th data-quarto-table-cell-role="th">leadType</th>
<th data-quarto-table-cell-role="th">fpStatus</th>
<th data-quarto-table-cell-role="th">clearfraudscore</th>
<th data-quarto-table-cell-role="th">fifteendaysago</th>
<th data-quarto-table-cell-role="th">ssnnamematch</th>
<th data-quarto-table-cell-role="th">overallmatchresult</th>
<th data-quarto-table-cell-role="th">totalnumberoffraudindicators</th>
<th data-quarto-table-cell-role="th">nameaddressmatch</th>
<th data-quarto-table-cell-role="th">isCollection_False</th>
<th data-quarto-table-cell-role="th">isCollection_True</th>
<th data-quarto-table-cell-role="th">approved_True</th>
<th data-quarto-table-cell-role="th">originated_True</th>
<th data-quarto-table-cell-role="th">creditestablishedbeforeage18_False</th>
<th data-quarto-table-cell-role="th">creditestablishedbeforeage18_True</th>
<th data-quarto-table-cell-role="th">currentaddressreportedbynewtradeonly_False</th>
<th data-quarto-table-cell-role="th">currentaddressreportedbynewtradeonly_True</th>
<th data-quarto-table-cell-role="th">morethan3inquiriesinthelast30days_False</th>
<th data-quarto-table-cell-role="th">morethan3inquiriesinthelast30days_True</th>
<th data-quarto-table-cell-role="th">inputssninvalid_False</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">5957</td>
<td>LL-I-00202645</td>
<td>Checked</td>
<td>1</td>
<td>0.00</td>
<td>31.56</td>
<td>W</td>
<td>478.67</td>
<td>1</td>
<td>600.0</td>
<td>1463.49</td>
<td>0.0</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>768.0</td>
<td>5.0</td>
<td>match</td>
<td>match</td>
<td>1.0</td>
<td>match</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5958</td>
<td>LL-I-00202645</td>
<td>Checked</td>
<td>2</td>
<td>8.40</td>
<td>55.23</td>
<td>W</td>
<td>478.67</td>
<td>1</td>
<td>600.0</td>
<td>1463.49</td>
<td>0.0</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>768.0</td>
<td>5.0</td>
<td>match</td>
<td>match</td>
<td>1.0</td>
<td>match</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5959</td>
<td>LL-I-00202645</td>
<td>Checked</td>
<td>3</td>
<td>9.17</td>
<td>54.46</td>
<td>W</td>
<td>478.67</td>
<td>1</td>
<td>600.0</td>
<td>1463.49</td>
<td>0.0</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>768.0</td>
<td>5.0</td>
<td>match</td>
<td>match</td>
<td>1.0</td>
<td>match</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5960</td>
<td>LL-I-00202645</td>
<td>Checked</td>
<td>4</td>
<td>572.41</td>
<td>0.00</td>
<td>W</td>
<td>478.67</td>
<td>1</td>
<td>600.0</td>
<td>1463.49</td>
<td>0.0</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>768.0</td>
<td>5.0</td>
<td>match</td>
<td>match</td>
<td>1.0</td>
<td>match</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5961</td>
<td>LL-I-00202645</td>
<td>Cancelled</td>
<td>5</td>
<td>10.02</td>
<td>53.61</td>
<td>W</td>
<td>478.67</td>
<td>1</td>
<td>600.0</td>
<td>1463.49</td>
<td>0.0</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>768.0</td>
<td>5.0</td>
<td>match</td>
<td>match</td>
<td>1.0</td>
<td>match</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">685598</td>
<td>LL-I-18518246</td>
<td>Cancelled</td>
<td>9</td>
<td>100.06</td>
<td>177.66</td>
<td>S</td>
<td>645.00</td>
<td>1</td>
<td>1000.0</td>
<td>3332.75</td>
<td>0.0</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>694.0</td>
<td>6.0</td>
<td>match</td>
<td>match</td>
<td>2.0</td>
<td>match</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">685599</td>
<td>LL-I-18518246</td>
<td>Cancelled</td>
<td>10</td>
<td>92.05</td>
<td>185.67</td>
<td>S</td>
<td>645.00</td>
<td>1</td>
<td>1000.0</td>
<td>3332.75</td>
<td>0.0</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>694.0</td>
<td>6.0</td>
<td>match</td>
<td>match</td>
<td>2.0</td>
<td>match</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">685600</td>
<td>LL-I-18518246</td>
<td>Cancelled</td>
<td>11</td>
<td>138.29</td>
<td>139.43</td>
<td>S</td>
<td>645.00</td>
<td>1</td>
<td>1000.0</td>
<td>3332.75</td>
<td>0.0</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>694.0</td>
<td>6.0</td>
<td>match</td>
<td>match</td>
<td>2.0</td>
<td>match</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">685601</td>
<td>LL-I-18518246</td>
<td>Cancelled</td>
<td>12</td>
<td>168.10</td>
<td>109.62</td>
<td>S</td>
<td>645.00</td>
<td>1</td>
<td>1000.0</td>
<td>3332.75</td>
<td>0.0</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>694.0</td>
<td>6.0</td>
<td>match</td>
<td>match</td>
<td>2.0</td>
<td>match</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">685602</td>
<td>LL-I-18518246</td>
<td>Cancelled</td>
<td>13</td>
<td>219.62</td>
<td>58.21</td>
<td>S</td>
<td>645.00</td>
<td>1</td>
<td>1000.0</td>
<td>3332.75</td>
<td>0.0</td>
<td>Paid Off Loan</td>
<td>lead</td>
<td>Checked</td>
<td>694.0</td>
<td>6.0</td>
<td>match</td>
<td>match</td>
<td>2.0</td>
<td>match</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>423402 rows × 31 columns</p>
</div>
</div>
</div>
<div id="cell-68" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>binary_list <span class="op">=</span> []</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> binary:</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    binary_list.append(<span class="ss">f"</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">_True"</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    binary_list.append(<span class="ss">f"</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">_False"</span>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(binary_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['isCollection_True', 'isCollection_False', 'approved_True', 'approved_False', 'originated_True', 'originated_False', 'creditestablishedbeforeage18_True', 'creditestablishedbeforeage18_False', 'currentaddressreportedbynewtradeonly_True', 'currentaddressreportedbynewtradeonly_False', 'morethan3inquiriesinthelast30days_True', 'morethan3inquiriesinthelast30days_False', 'inputssninvalid_True', 'inputssninvalid_False']</code></pre>
</div>
</div>
</section>
<section id="label-encoding" class="level4">
<h4 class="anchored" data-anchor-id="label-encoding">Label encoding</h4>
<div id="cell-70" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print your categorical columns</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Categorical columns:"</span>, categorical)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print dataframe columns </span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Dataframe columns:"</span>, df_encoded.columns.tolist())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Categorical columns: ['loanId', 'paymentStatus', 'payFrequency', 'loanStatus', 'leadType', 'fpStatus', 'creditestablishedbeforeage18', 'ssnnamematch', 'currentaddressreportedbynewtradeonly', 'morethan3inquiriesinthelast30days', 'overallmatchresult', 'inputssninvalid', 'nameaddressmatch']

Dataframe columns: ['loanId', 'paymentStatus', 'installmentIndex', 'principal', 'fees', 'payFrequency', 'apr', 'isFunded', 'loanAmount', 'originallyScheduledPaymentAmount', 'nPaidOff', 'loanStatus', 'leadType', 'fpStatus', 'clearfraudscore', 'fifteendaysago', 'ssnnamematch', 'overallmatchresult', 'totalnumberoffraudindicators', 'nameaddressmatch', 'isCollection_False', 'isCollection_True', 'approved_True', 'originated_True', 'creditestablishedbeforeage18_False', 'creditestablishedbeforeage18_True', 'currentaddressreportedbynewtradeonly_False', 'currentaddressreportedbynewtradeonly_True', 'morethan3inquiriesinthelast30days_False', 'morethan3inquiriesinthelast30days_True', 'inputssninvalid_False']</code></pre>
</div>
</div>
<div id="cell-71" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> encode_categories(df):</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    df_encoded <span class="op">=</span> df.copy()</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    encoders <span class="op">=</span> {}</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> categorical:</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>        encoders[col] <span class="op">=</span> LabelEncoder()</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>        df_encoded[col] <span class="op">=</span> encoders[col].fit_transform(df[col].fillna(<span class="st">'Missing'</span>))</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_encoded, encoders</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>df_en, encoders <span class="op">=</span> encode_categories(df_encoded)</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> categorical[<span class="dv">1</span>:]:</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>    print_distinct(df_en, i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-------------- payFrequency --------------
| 4 | 0 | 3 | 2 | 1 |
-------------- loanStatus --------------
| 5 | 2 | 9 | 1 | 6 |
| 8 | 3 | 4 | 7 | 0 |
-------------- leadType --------------
| 2 | 4 | 0 | 1 | 5 |
| 3 | 7 | 6 |
-------------- fpStatus --------------
| 1 | 2 | 0 | 3 |
-------------- ssnnamematch --------------
| 0 | 2 | 1 | 3 |
-------------- overallmatchresult --------------
| 0 | 3 | 2 | 1 |
-------------- nameaddressmatch --------------
| 1 | 0 | 2 | 3 | 4 |</code></pre>
</div>
</div>
<div id="cell-72" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> label, value <span class="kw">in</span> <span class="bu">enumerate</span>(encoders[<span class="st">'paymentStatus'</span>].classes_):</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>value<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cancelled: 0
Checked: 1
Pending: 2
Rejected: 3
Rejected Awaiting Retry: 4
Skipped: 5</code></pre>
</div>
</div>
<p>Great! it works. Our last concern now is how do we aggregate the installment index and the behaviour on during those installments. If we were to sequentally approache the feature to add on like installment_1, payment_1, principal_1 then it would resulted in a missing value. Before that, we need to modify this label encoder.</p>
<div id="cell-74" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> encode_loan_categories(df):</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    df_encoded <span class="op">=</span> df.copy()</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    encoders <span class="op">=</span> {}</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    risk_order <span class="op">=</span> {</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Checked'</span>: <span class="dv">0</span>,</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pending'</span>: <span class="dv">1</span>, </span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Rejected Awaiting Retry'</span>: <span class="dv">2</span>,</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Skipped'</span>: <span class="dv">3</span>,</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Cancelled'</span>: <span class="dv">4</span>,</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Rejected'</span>: <span class="dv">5</span>,</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'None'</span>: <span class="dv">6</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>    df_encoded[<span class="st">'paymentStatus'</span>] <span class="op">=</span> df[<span class="st">'paymentStatus'</span>].<span class="bu">map</span>(risk_order)</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>    categorical <span class="op">=</span> df.select_dtypes(include<span class="op">=</span>[<span class="st">'object'</span>]).columns</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> [c <span class="cf">for</span> c <span class="kw">in</span> categorical <span class="cf">if</span> c <span class="op">!=</span> <span class="st">'paymentStatus'</span>]:</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>        encoders[col] <span class="op">=</span> LabelEncoder()</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>        df_encoded[col] <span class="op">=</span> encoders[col].fit_transform(df[col].fillna(<span class="st">'Missing'</span>))</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_encoded, encoders</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply encoding</span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>df_en, encoders <span class="op">=</span> encode_loan_categories(df_encoded)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sequential-wide-data-frame-transformation" class="level4">
<h4 class="anchored" data-anchor-id="sequential-wide-data-frame-transformation"><strong>Sequential Wide data frame transformation</strong></h4>
<div id="cell-77" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sequential_feature(df, max_installments):</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>    df_sorted <span class="op">=</span> df.sort_values([<span class="st">'loanId'</span>, <span class="st">'installmentIndex'</span>])</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> {}</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    defaults <span class="op">=</span> {</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'paymentStatus'</span>: <span class="dv">6</span>,</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'installmentIndex'</span>: <span class="dv">0</span>,</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'principal'</span>: <span class="fl">0.0</span>,</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'fees'</span>: <span class="fl">0.0</span>,</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'isCollection'</span>: <span class="dv">0</span>  </span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> loan_id, loan_data <span class="kw">in</span> df_sorted.groupby(<span class="st">'loanId'</span>):</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>        loan_features <span class="op">=</span> {}</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, max_installments <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>            loan_features.update({</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'payment</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_status'</span>: defaults[<span class="st">'paymentStatus'</span>],</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'payment</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_index'</span>: defaults[<span class="st">'installmentIndex'</span>],</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'payment</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_principal'</span>: defaults[<span class="st">'principal'</span>],</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'payment</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_fees'</span>: defaults[<span class="st">'fees'</span>],</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'payment</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_isCollection'</span>: defaults[<span class="st">'isCollection'</span>]</span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill actual values</span></span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, payment <span class="kw">in</span> <span class="bu">enumerate</span>(loan_data.itertuples(), <span class="dv">1</span>):</span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">&lt;=</span> max_installments:</span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>                loan_features[<span class="ss">f'payment</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_status'</span>] <span class="op">=</span> payment.paymentStatus</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>                loan_features[<span class="ss">f'payment</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_index'</span>] <span class="op">=</span> payment.installmentIndex</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>                loan_features[<span class="ss">f'payment</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_principal'</span>] <span class="op">=</span> payment.principal</span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>                loan_features[<span class="ss">f'payment</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_fees'</span>] <span class="op">=</span> payment.fees</span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Check which column exists</span></span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">hasattr</span>(payment, <span class="st">'isCollection'</span>):</span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>                    loan_features[<span class="ss">f'payment</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_isCollection'</span>] <span class="op">=</span> payment.isCollection</span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> <span class="bu">hasattr</span>(payment, <span class="st">'isCollection_True'</span>):</span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>                    loan_features[<span class="ss">f'payment</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_isCollection'</span>] <span class="op">=</span> payment.isCollection_True</span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> <span class="bu">hasattr</span>(payment, <span class="st">'isCollection_False'</span>):</span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a>                    loan_features[<span class="ss">f'payment</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_isCollection'</span>] <span class="op">=</span> <span class="kw">not</span> payment.isCollection_False</span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a>        features[loan_id] <span class="op">=</span> loan_features</span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame.from_dict(features, orient<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a>df_wide <span class="op">=</span> sequential_feature(df_en, <span class="bu">max</span>(df_en[<span class="st">'installmentIndex'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-78" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>    print_distinct(df_wide, <span class="ss">f'payment</span><span class="sc">{</span>x<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">_status'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-------------- payment1_status --------------
| 0 | 5 | 4 | 3 | 1 |
-------------- payment2_status --------------
| 0 | 5 | 4 | 3 | 6 |
| 1 |
-------------- payment3_status --------------
| 0 | 5 | 4 | 1 | 3 |
| 6 |
-------------- payment4_status --------------
| 0 | 4 | 5 | 3 | 6 |
| 2 | 1 |
-------------- payment5_status --------------
| 4 | 0 | 5 | 3 | 6 |
| 1 |
-------------- payment6_status --------------
| 4 | 0 | 5 | 6 | 3 |
| 2 | 1 |
-------------- payment7_status --------------
| 4 | 0 | 5 | 6 | 3 |
| 1 |
-------------- payment8_status --------------
| 4 | 0 | 3 | 5 | 6 |
| 2 | 1 |
-------------- payment9_status --------------
| 4 | 0 | 5 | 3 | 6 |
| 1 |
-------------- payment10_status --------------
| 4 | 0 | 3 | 5 | 6 |
| 2 | 1 |</code></pre>
</div>
</div>
</section>
<section id="concurrent-loanid-long-data-frame" class="level4">
<h4 class="anchored" data-anchor-id="concurrent-loanid-long-data-frame"><strong>concurrent loanId long data frame</strong></h4>
<div id="cell-80" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>df_1, encoder_1<span class="op">=</span> encode_categories(df_impute)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>df_long <span class="op">=</span> df_1.iloc[:, <span class="dv">1</span>:]</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>df_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">paymentStatus</th>
<th data-quarto-table-cell-role="th">installmentIndex</th>
<th data-quarto-table-cell-role="th">isCollection</th>
<th data-quarto-table-cell-role="th">principal</th>
<th data-quarto-table-cell-role="th">fees</th>
<th data-quarto-table-cell-role="th">payFrequency</th>
<th data-quarto-table-cell-role="th">apr</th>
<th data-quarto-table-cell-role="th">isFunded</th>
<th data-quarto-table-cell-role="th">approved</th>
<th data-quarto-table-cell-role="th">loanAmount</th>
<th data-quarto-table-cell-role="th">originallyScheduledPaymentAmount</th>
<th data-quarto-table-cell-role="th">nPaidOff</th>
<th data-quarto-table-cell-role="th">originated</th>
<th data-quarto-table-cell-role="th">loanStatus</th>
<th data-quarto-table-cell-role="th">leadType</th>
<th data-quarto-table-cell-role="th">fpStatus</th>
<th data-quarto-table-cell-role="th">clearfraudscore</th>
<th data-quarto-table-cell-role="th">fifteendaysago</th>
<th data-quarto-table-cell-role="th">creditestablishedbeforeage18</th>
<th data-quarto-table-cell-role="th">ssnnamematch</th>
<th data-quarto-table-cell-role="th">currentaddressreportedbynewtradeonly</th>
<th data-quarto-table-cell-role="th">morethan3inquiriesinthelast30days</th>
<th data-quarto-table-cell-role="th">overallmatchresult</th>
<th data-quarto-table-cell-role="th">totalnumberoffraudindicators</th>
<th data-quarto-table-cell-role="th">inputssninvalid</th>
<th data-quarto-table-cell-role="th">nameaddressmatch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">5957</td>
<td>1</td>
<td>1</td>
<td>False</td>
<td>0.00</td>
<td>31.56</td>
<td>4</td>
<td>478.67</td>
<td>1</td>
<td>True</td>
<td>600.0</td>
<td>1463.49</td>
<td>0.0</td>
<td>True</td>
<td>5</td>
<td>2</td>
<td>1</td>
<td>768.0</td>
<td>5.0</td>
<td>False</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>0</td>
<td>1.0</td>
<td>False</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5958</td>
<td>1</td>
<td>2</td>
<td>False</td>
<td>8.40</td>
<td>55.23</td>
<td>4</td>
<td>478.67</td>
<td>1</td>
<td>True</td>
<td>600.0</td>
<td>1463.49</td>
<td>0.0</td>
<td>True</td>
<td>5</td>
<td>2</td>
<td>1</td>
<td>768.0</td>
<td>5.0</td>
<td>False</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>0</td>
<td>1.0</td>
<td>False</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5959</td>
<td>1</td>
<td>3</td>
<td>False</td>
<td>9.17</td>
<td>54.46</td>
<td>4</td>
<td>478.67</td>
<td>1</td>
<td>True</td>
<td>600.0</td>
<td>1463.49</td>
<td>0.0</td>
<td>True</td>
<td>5</td>
<td>2</td>
<td>1</td>
<td>768.0</td>
<td>5.0</td>
<td>False</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>0</td>
<td>1.0</td>
<td>False</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5960</td>
<td>1</td>
<td>4</td>
<td>False</td>
<td>572.41</td>
<td>0.00</td>
<td>4</td>
<td>478.67</td>
<td>1</td>
<td>True</td>
<td>600.0</td>
<td>1463.49</td>
<td>0.0</td>
<td>True</td>
<td>5</td>
<td>2</td>
<td>1</td>
<td>768.0</td>
<td>5.0</td>
<td>False</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>0</td>
<td>1.0</td>
<td>False</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5961</td>
<td>0</td>
<td>5</td>
<td>False</td>
<td>10.02</td>
<td>53.61</td>
<td>4</td>
<td>478.67</td>
<td>1</td>
<td>True</td>
<td>600.0</td>
<td>1463.49</td>
<td>0.0</td>
<td>True</td>
<td>5</td>
<td>2</td>
<td>1</td>
<td>768.0</td>
<td>5.0</td>
<td>False</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>0</td>
<td>1.0</td>
<td>False</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">685598</td>
<td>0</td>
<td>9</td>
<td>False</td>
<td>100.06</td>
<td>177.66</td>
<td>3</td>
<td>645.00</td>
<td>1</td>
<td>True</td>
<td>1000.0</td>
<td>3332.75</td>
<td>0.0</td>
<td>True</td>
<td>5</td>
<td>2</td>
<td>1</td>
<td>694.0</td>
<td>6.0</td>
<td>False</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>0</td>
<td>2.0</td>
<td>False</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">685599</td>
<td>0</td>
<td>10</td>
<td>False</td>
<td>92.05</td>
<td>185.67</td>
<td>3</td>
<td>645.00</td>
<td>1</td>
<td>True</td>
<td>1000.0</td>
<td>3332.75</td>
<td>0.0</td>
<td>True</td>
<td>5</td>
<td>2</td>
<td>1</td>
<td>694.0</td>
<td>6.0</td>
<td>False</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>0</td>
<td>2.0</td>
<td>False</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">685600</td>
<td>0</td>
<td>11</td>
<td>False</td>
<td>138.29</td>
<td>139.43</td>
<td>3</td>
<td>645.00</td>
<td>1</td>
<td>True</td>
<td>1000.0</td>
<td>3332.75</td>
<td>0.0</td>
<td>True</td>
<td>5</td>
<td>2</td>
<td>1</td>
<td>694.0</td>
<td>6.0</td>
<td>False</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>0</td>
<td>2.0</td>
<td>False</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">685601</td>
<td>0</td>
<td>12</td>
<td>False</td>
<td>168.10</td>
<td>109.62</td>
<td>3</td>
<td>645.00</td>
<td>1</td>
<td>True</td>
<td>1000.0</td>
<td>3332.75</td>
<td>0.0</td>
<td>True</td>
<td>5</td>
<td>2</td>
<td>1</td>
<td>694.0</td>
<td>6.0</td>
<td>False</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>0</td>
<td>2.0</td>
<td>False</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">685602</td>
<td>0</td>
<td>13</td>
<td>False</td>
<td>219.62</td>
<td>58.21</td>
<td>3</td>
<td>645.00</td>
<td>1</td>
<td>True</td>
<td>1000.0</td>
<td>3332.75</td>
<td>0.0</td>
<td>True</td>
<td>5</td>
<td>2</td>
<td>1</td>
<td>694.0</td>
<td>6.0</td>
<td>False</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>0</td>
<td>2.0</td>
<td>False</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>423402 rows × 26 columns</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="modelling" class="level2">
<h2 class="anchored" data-anchor-id="modelling">4. Modelling</h2>
<p>We’ve assembled two types of dataset for this model. To put it simply, one long and one wide.:</p>
<ul>
<li>long dataset <code>df_long</code> : installmentIndex remains the same. For each installmentindex, the loan id is the same until it moves on the next installmentIndex</li>
<li>wide dataset <code>df_wide</code> : Each row is a unique loanId. installmentIndex is sequentially added along with supplementary information such as paymentStatus, and the rest.</li>
</ul>
<p>df_long use case: this dataset will be fitted into a machine learning model attempting to predict payment status and interpret result df_wide use case: to develop our own algorithm that can categorize specific borrowers of their risk levels, aligning with our business context</p>
<div id="cell-83" class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> weighted_risk_score(df):</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    status_columns <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> <span class="st">'status'</span> <span class="kw">in</span> col]</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define risk weights that increase with severity</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    risk_weights <span class="op">=</span> {</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>: <span class="fl">0.0</span>,   <span class="co"># Completed - Lowest risk </span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>: <span class="fl">0.2</span>,     </span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>: <span class="fl">0.5</span>,     </span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>: <span class="fl">0.7</span>,    </span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>        <span class="dv">4</span>: <span class="fl">0.9</span>,     </span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>        <span class="dv">5</span>: <span class="fl">1.0</span>      <span class="co"># Rejected - Maximum risk</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> time_weight(payment_number):</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> <span class="fl">0.1</span> <span class="op">*</span> payment_number)  </span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> calculate_loan_risk(row):</span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>        total_weight <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>        risk_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, col <span class="kw">in</span> <span class="bu">enumerate</span>(status_columns):</span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>            status_value <span class="op">=</span> row[col]</span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>            risk_value <span class="op">=</span> risk_weights.get(status_value, <span class="dv">0</span>)</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>            time_value <span class="op">=</span> time_weight(i)</span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>            risk_score <span class="op">+=</span> risk_value <span class="op">*</span> time_value</span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>            total_weight <span class="op">+=</span> time_value</span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (risk_score <span class="op">/</span> total_weight) <span class="cf">if</span> total_weight <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'risk_score'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(calculate_loan_risk, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Categorize risk levels</span></span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'risk_category'</span>] <span class="op">=</span> pd.cut(df[<span class="st">'risk_score'</span>], </span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a>                                bins<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span>],</span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a>                                labels<span class="op">=</span>[<span class="st">'Very Low'</span>, <span class="st">'Low'</span>, <span class="st">'Medium'</span>, <span class="st">'High'</span>, <span class="st">'Very High'</span>])</span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a>df_result <span class="op">=</span> weighted_risk_score(df_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-84" class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>loan_ids <span class="op">=</span> pd.DataFrame(df_impute[<span class="st">'loanId'</span>].unique(), columns<span class="op">=</span>[<span class="st">'loanId'</span>])</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>df_risk <span class="op">=</span> pd.concat([loan_ids, df_result[[<span class="st">'risk_score'</span>, <span class="st">'risk_category'</span>]]], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>df_risk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="94">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">loanId</th>
<th data-quarto-table-cell-role="th">risk_score</th>
<th data-quarto-table-cell-role="th">risk_category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>LL-I-00202645</td>
<td>0.339224</td>
<td>Low</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>LL-I-00202774</td>
<td>0.266060</td>
<td>Low</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>LL-I-00204105</td>
<td>0.000000</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>LL-I-00204517</td>
<td>0.053147</td>
<td>Very Low</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>LL-I-00206077</td>
<td>0.242621</td>
<td>Low</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30493</td>
<td>LL-I-18368434</td>
<td>0.008036</td>
<td>Very Low</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30494</td>
<td>LL-I-18397547</td>
<td>0.008036</td>
<td>Very Low</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30495</td>
<td>LL-I-18403128</td>
<td>0.241839</td>
<td>Low</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30496</td>
<td>LL-I-18441013</td>
<td>0.283532</td>
<td>Low</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30497</td>
<td>LL-I-18518246</td>
<td>0.066197</td>
<td>Very Low</td>
</tr>
</tbody>
</table>

<p>30498 rows × 3 columns</p>
</div>
</div>
</div>
<p>Alright this is just a risk weightage algorithm I thought of as an intution. Therefore, no machine learning model is used.</p>
<p>The algorithm uses two main components:</p>
<ol type="1">
<li>Risk Weights: We assign increasing weights from 0 to 1 based on payment status severity. It’s like a grading scale where:</li>
</ol>
<ul>
<li>0 (Checked) = A+ borrower, always pays on time</li>
<li>0.2 (Pending) = B student, mostly reliable</li>
<li>0.5 (Rejected Awaiting Retry) = C borrower, showing concerning signs</li>
<li>0.7 (Cancelled) = D borrower, significant issues -&gt; probably financial issues or personal.</li>
<li>0.9 (Skipped) = F borrower, <strong>major</strong> red flags</li>
<li>1.0 (Rejected) = Complete failure to meet requirements</li>
</ul>
<ol start="2" type="1">
<li>Time Decay Function: We use an exponential decay formula: 1/(1 + 0.1 * payment_number) Think of it like your memory - recent events are clearer than distant ones, but early payments carry special weight in predicting behavior.</li>
</ol>
<p>The final risk score combines these factors: risk_score = Σ(risk_weight * time_weight) / Σ(time_weights)</p>
<p>I divide them by total weights to normalize this approach so we can ensure scores ranges between 0-1 making them easy to interpret and categorize into risk levels. This draws inspiration from FICO scores where they look at payment history with higher weights on recent activities.</p>
<p>Therefore, lets say loanId LL-I-00202645 has a risk score of 0.339224 on which we categorize it into low category. There are some issue with this. since some category is Nan, but this is up for discussions with other data scientist so we can develop our own model based on the relevant business context and situation.</p>
<section id="data-partitioning" class="level4">
<h4 class="anchored" data-anchor-id="data-partitioning"><strong>Data Partitioning</strong></h4>
<div id="cell-87" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_long.drop(<span class="st">'paymentStatus'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_long[<span class="st">'paymentStatus'</span>]</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Splitting data..."</span>)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>X_train_scaled <span class="op">=</span> scaler.fit_transform(X_train)</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>X_test_scaled <span class="op">=</span> scaler.transform(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Splitting data...</code></pre>
</div>
</div>
<div id="cell-88" class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>class_weights <span class="op">=</span> {<span class="dv">0</span>: <span class="dv">1</span>, <span class="dv">1</span>: <span class="dv">1</span>, <span class="dv">2</span>: <span class="dv">5</span>, <span class="dv">3</span>: <span class="dv">5</span>, <span class="dv">4</span>: <span class="dv">10</span>, <span class="dv">5</span>: <span class="dv">10</span>, <span class="dv">6</span>: <span class="dv">15</span>}</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> {</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="st">'Random Forest'</span>: RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="st">'Logistic Regression'</span>: LogisticRegression(class_weight<span class="op">=</span>class_weights, max_iter<span class="op">=</span><span class="dv">1000</span>),</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="st">'Decision Tree'</span>: DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="st">'KNN'</span>: KNeighborsClassifier(n_neighbors<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="st">'Naive Bayes'</span>: GaussianNB()</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> {}</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> machine_learning(X_train_scaled,y_train, model):</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"fitting models...</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Stage 1: fitting </span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> time.time()</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train_scaled, y_train)</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Stage 2: predicting </span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model.predict(X_test_scaled)</span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Stage 3: collecting accuracy </span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="op">=</span> accuracy_score(y_test, y_pred)</span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a>    cv_scores <span class="op">=</span> cross_val_score(model, X_train_scaled, y_train, cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>    results[model] <span class="op">=</span> {</span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Accuracy'</span>: accuracy,</span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CV Mean'</span>: cv_scores.mean(),</span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CV Std'</span>: cv_scores.std(),</span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Model'</span>: model,</span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Classification Report'</span>: classification_report(y_test, y_pred)}</span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Test Accuracy: </span><span class="sc">{</span>results[model][<span class="st">'Accuracy'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"CV Mean Accuracy: </span><span class="sc">{</span>results[model][<span class="st">'CV Mean'</span>]<span class="sc">:.4f}</span><span class="ss"> (+/- </span><span class="sc">{</span>results[model][<span class="st">'CV Std'</span>]<span class="op">*</span><span class="dv">2</span><span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Classification Report:"</span>)</span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(results[model][<span class="st">'Classification Report'</span>])</span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a>    end <span class="op">=</span> time.time()</span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss"> took </span><span class="sc">{</span>end<span class="op">-</span>start<span class="op">/</span><span class="dv">60</span><span class="sc">}</span><span class="ss"> minutes</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"---------------------------------------------</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-42"><a href="#cb98-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results, scaler</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="random-forest" class="level4">
<h4 class="anchored" data-anchor-id="random-forest"><strong>Random Forest</strong></h4>
<div id="cell-90" class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>results_rf, scaler_rf <span class="op">=</span> machine_learning(X_train_scaled,y_train, model<span class="op">=</span>models[<span class="st">'Random Forest'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fitting models...

Stage 1: fitting RandomForestClassifier(random_state=42)
Stage 2: predicting RandomForestClassifier(random_state=42)
Stage 3: collecting accuracy RandomForestClassifier(random_state=42)

Max Principal:
Test Accuracy: 0.8778
CV Mean Accuracy: 0.8705 (+/- 0.0015)

Classification Report:
              precision    recall  f1-score   support

           0       0.92      0.94      0.93     43173
           1       0.86      0.93      0.89     34135
           2       0.63      0.20      0.30      1464
           3       0.61      0.31      0.41      5350
           4       1.00      0.50      0.67         2
           5       0.32      0.02      0.04       557

    accuracy                           0.88     84681
   macro avg       0.72      0.48      0.54     84681
weighted avg       0.86      0.88      0.86     84681

RandomForestClassifier(random_state=42) took 266.53777289390564 minutes

---------------------------------------------
</code></pre>
</div>
</div>
<p>Random Forest results show 87.78% test accuracy with stable cross-validation (87.05% ± 0.15%). Strong performance for common statuses (Checked/Pending), weak for rare cases (Rejected/Skipped). Class imbalance evident from support numbers.</p>
</section>
<section id="logistic-regression" class="level4">
<h4 class="anchored" data-anchor-id="logistic-regression"><strong>Logistic Regression</strong></h4>
<div id="cell-93" class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>results_lr, scaler_lr <span class="op">=</span> machine_learning(X_train_scaled,y_train, models[<span class="st">'Logistic Regression'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fitting models...

Stage 1: fitting LogisticRegression(class_weight={0: 1, 1: 1, 2: 5, 3: 5, 4: 10, 5: 10, 6: 15},
                   max_iter=1000)
Stage 2: predicting LogisticRegression(class_weight={0: 1, 1: 1, 2: 5, 3: 5, 4: 10, 5: 10, 6: 15},
                   max_iter=1000)
Stage 3: collecting accuracy LogisticRegression(class_weight={0: 1, 1: 1, 2: 5, 3: 5, 4: 10, 5: 10, 6: 15},
                   max_iter=1000)
Test Accuracy: 0.6728
CV Mean Accuracy: 0.6718 (+/- 0.0053)

Classification Report:
              precision    recall  f1-score   support

           0       0.80      0.73      0.77     43173
           1       0.70      0.65      0.67     34135
           2       0.00      0.00      0.00      1464
           3       0.24      0.63      0.35      5350
           4       0.00      0.00      0.00         2
           5       0.12      0.00      0.00       557

    accuracy                           0.67     84681
   macro avg       0.31      0.33      0.30     84681
weighted avg       0.71      0.67      0.68     84681

LogisticRegression(class_weight={0: 1, 1: 1, 2: 5, 3: 5, 4: 10, 5: 10, 6: 15},
                   max_iter=1000) took 1018.0610268115997 minutes

---------------------------------------------
</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/karimazizc/anaconda3/lib/python3.11/site-packages/sklearn/metrics/_classification.py:1469: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/Users/karimazizc/anaconda3/lib/python3.11/site-packages/sklearn/metrics/_classification.py:1469: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/Users/karimazizc/anaconda3/lib/python3.11/site-packages/sklearn/metrics/_classification.py:1469: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))</code></pre>
</div>
</div>
<p>Logistic Regression achieves 67.28% accuracy (lower than random forest) with good detection of low-risk loans but critically fails on high-risk categories despite class weighting. Poor recall on risky loans makes it unsuitable for loan assessment.</p>
</section>
<section id="decision-tree" class="level4">
<h4 class="anchored" data-anchor-id="decision-tree"><strong>Decision Tree</strong></h4>
<div id="cell-96" class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>results_dt, scaler_dt <span class="op">=</span> machine_learning(X_train_scaled,y_train, models[<span class="st">'Decision Tree'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fitting models...

Stage 1: fitting DecisionTreeClassifier(random_state=42)
Stage 2: predicting DecisionTreeClassifier(random_state=42)
Stage 3: collecting accuracy DecisionTreeClassifier(random_state=42)
Test Accuracy: 0.7997
CV Mean Accuracy: 0.7918 (+/- 0.0042)

Classification Report:
              precision    recall  f1-score   support

           0       0.88      0.87      0.88     43173
           1       0.81      0.81      0.81     34135
           2       0.30      0.31      0.31      1464
           3       0.34      0.36      0.35      5350
           4       0.17      0.50      0.25         2
           5       0.05      0.07      0.06       557

    accuracy                           0.80     84681
   macro avg       0.43      0.49      0.44     84681
weighted avg       0.80      0.80      0.80     84681

DecisionTreeClassifier(random_state=42) took 16.579161167144775 minutes

---------------------------------------------
</code></pre>
</div>
</div>
<p>The Decision Tree classifier achieves 80% accuracy, performing well on common payment statuses but struggling with rare cases. Its cross-validation stability at 79.18% demonstrates consistent but imperfect predictive ability.</p>
</section>
<section id="k-nearest-neighbor" class="level4">
<h4 class="anchored" data-anchor-id="k-nearest-neighbor"><strong>K Nearest Neighbor</strong></h4>
<div id="cell-99" class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>results_dt, scaler_dt <span class="op">=</span> machine_learning(X_train_scaled,y_train, models[<span class="st">'KNN'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fitting models...

Stage 1: fitting KNeighborsClassifier()
Stage 2: predicting KNeighborsClassifier()
Stage 3: collecting accuracy KNeighborsClassifier()
Test Accuracy: 0.8515
CV Mean Accuracy: 0.8362 (+/- 0.0020)

Classification Report:
              precision    recall  f1-score   support

           0       0.86      0.96      0.91     43173
           1       0.86      0.89      0.88     34135
           2       0.32      0.03      0.05      1464
           3       0.30      0.06      0.10      5350
           4       0.00      0.00      0.00         2
           5       0.07      0.00      0.00       557

    accuracy                           0.85     84681
   macro avg       0.40      0.32      0.32     84681
weighted avg       0.81      0.85      0.82     84681

KNeighborsClassifier() took 180.14647603034973 minutes

---------------------------------------------
</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/karimazizc/anaconda3/lib/python3.11/site-packages/sklearn/metrics/_classification.py:1469: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/Users/karimazizc/anaconda3/lib/python3.11/site-packages/sklearn/metrics/_classification.py:1469: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/Users/karimazizc/anaconda3/lib/python3.11/site-packages/sklearn/metrics/_classification.py:1469: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))</code></pre>
</div>
</div>
<p>85.15% accuracy, slightly lower than Random Forest (87.78%) but better than Logistic Regression (67.28%) and Decision Tree (79.97%). Strong with common payment statuses but near-zero performance on rare cases. Cross-validation shows stable performance at 83.62%.</p>
</section>
<section id="naive-bayes" class="level4">
<h4 class="anchored" data-anchor-id="naive-bayes"><strong>Naive Bayes</strong></h4>
<div id="cell-102" class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>results_dt, scaler_dt <span class="op">=</span> machine_learning(X_train_scaled,y_train, models[<span class="st">'Naive Bayes'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fitting models...

Stage 1: fitting GaussianNB()
Stage 2: predicting GaussianNB()
Stage 3: collecting accuracy GaussianNB()
Test Accuracy: 0.1092
CV Mean Accuracy: 0.1119 (+/- 0.0087)

Classification Report:
              precision    recall  f1-score   support

           0       0.84      0.17      0.29     43173
           1       0.61      0.03      0.07     34135
           2       0.04      0.00      0.00      1464
           3       0.12      0.01      0.02      5350
           4       0.00      1.00      0.00         2
           5       0.01      0.97      0.02       557

    accuracy                           0.11     84681
   macro avg       0.27      0.37      0.06     84681
weighted avg       0.68      0.11      0.17     84681

GaussianNB() took 1.205976963043213 minutes

---------------------------------------------
</code></pre>
</div>
</div>
<p>Naive Bayes performs extremely poorly at 10.92% accuracy - significantly worse than all other models (RF: 87.78%, KNN: 85.15%, DT: 79.97%, LR: 72.92%). Shows unusual behavior by catching rare cases but missing common ones. <strong>NOT SUITABLE</strong> for this payment status prediction task.</p>
<p>Random Forest emerges as the champion model with 87.78% accuracy, demonstrating superior performance across payment status predictions. Its strength lies in handling both common statuses (Checked/Pending: &gt;90% precision) and maintaining moderate performance on rare cases.</p>
<p>Model comparison by accuracy: 1. Random Forest: 87.78% 2. KNN: 85.15% 3. Decision Tree: 79.97% 4. Logistic Regression: 72.92% 5. Naive Bayes: 10.92%</p>
<p>While Random Forest excels in accuracy, KNN performs well but struggles with rare cases. Logistic Regression handles only majority classes effectively. Naive Bayes proves unsuitable for this payment prediction task.</p>
<p><strong>All models face challenges with class imbalance,</strong> particularly for statuses like Rejected and Skipped. For production implementation, Random Forest’s balance of accuracy and stability makes it the recommended choice for prediction. For interpretation However, decision tree will be best.</p>
</section>
<section id="interpreting-decision-tree" class="level4">
<h4 class="anchored" data-anchor-id="interpreting-decision-tree"><strong>Interpreting decision tree</strong></h4>
<div id="cell-106" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.inspection <span class="im">import</span> partial_dependence, PartialDependenceDisplay</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>features_to_plot <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]  </span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> [<span class="st">'installmentIndex'</span>, <span class="st">'isCollection'</span>, <span class="st">'fees'</span>,</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'fpStatus'</span>, <span class="st">'clearfraudscore'</span>,<span class="st">'payFrequency'</span> ]</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>display <span class="op">=</span> PartialDependenceDisplay.from_estimator(</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>  models[<span class="st">'Decision Tree'</span>].fit(X_train_scaled, y_train),</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>  X_train_scaled,</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>  features_to_plot,</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>  target<span class="op">=</span><span class="dv">0</span>,  <span class="co"># Add target class</span></span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>  feature_names<span class="op">=</span>feature_names</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-62-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="decision-tree-interpretation" class="level4">
<h4 class="anchored" data-anchor-id="decision-tree-interpretation"><strong>Decision Tree interpretation</strong></h4>
<p>According to the decision tree model, The partial dependence plots reveal that installment index is the strongest predictor, showing loan risk increases significantly in early payments before stabilizing. Fraud scores have a gradual negative impact, suggesting higher scores correlate with lower risk. Surprisingly, fees is the most stable and Collection status shows minimal influence. Additionally, first payment status maintains consistent impact across categories.</p>
<p>Interesting note is that pay frequency’s spikes might indicate that borrowers who choose unusual payment schedules could be facing underlying financial challenges. It’s like how someone asking for non-standard payment arrangements might be showing signs of financial stress.</p>
</section>
</section>
<section id="model-limitation" class="level2">
<h2 class="anchored" data-anchor-id="model-limitation">5. Model Limitation</h2>
<p>as expected, the machine learning model for random forest, decision tree and knn is predict far superior than Logistic regression and Naive Bayes</p>
<section id="limitation" class="level4">
<h4 class="anchored" data-anchor-id="limitation"><strong>Limitation:</strong></h4>
<ul>
<li>As this is just a simple model before we scale up, our model will eventually become more sophisticated.</li>
<li>ALL models struggle with minority classes</li>
<li>Data is heavily imbalanced, which might explain why they all performed poorly on minority classess. As algorithms naturally bias toward majority classes to maximize overall accuracy.</li>
<li>Models is not ready for professional deployment, need to perform hyperparameter tuning</li>
</ul>
<p>In our loan payment analysis, with common statuses like ‘Checked’ having nearly 40 times more examples than ‘Skipped’ or ‘Rejected’, models couldn’t learn reliable patterns for rare cases. This imbalance particularly affected simpler algorithms like Logistic Regression, which failed completely on minority classes. Even the more sophisticated Random Forest, while performing better overall, still showed significant weakness in predicting these critical but uncommon payment statuses.</p>
</section>
<section id="potential-solutions" class="level4">
<h4 class="anchored" data-anchor-id="potential-solutions"><strong>Potential Solutions:</strong></h4>
<ul>
<li>Oversampling methods</li>
<li>Class weights</li>
<li>Collecting more data for rare cases</li>
<li>Better feature engineering</li>
</ul>
</section>
<section id="fitting-issues" class="level4">
<h4 class="anchored" data-anchor-id="fitting-issues"><strong>Fitting issues:</strong></h4>
<p>Random Forest (87.78% test, 87.05% CV): - Slight overfitting, but its not an issue - Complex model capturing noise</p>
<p>Logistic Regression (67.28% test, 67.18% CV): - Balanced but scored very low - Too simple for complex patterns</p>
<p>KNN (85.15% test, 83.62% CV): - Moderate overfitting - Sensitive to training data</p>
<p>Decision Tree (79.97% test, 79.18% CV): - Slight overfitting, but its not an issue - Missing some key patterns</p>
<p>All models particularly struggle with minority classes.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>